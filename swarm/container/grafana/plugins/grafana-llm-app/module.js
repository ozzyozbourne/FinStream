define(["@grafana/data","react","@grafana/runtime","@grafana/ui","rxjs","@emotion/css"],((e,t,r,n,a,o)=>(()=>{var i={3274:(e,t,r)=>{const n=Symbol("SemVer ANY");class a{static get ANY(){return n}constructor(e,t){if(t=o(t),e instanceof a){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===n?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?i[s.COMPARATORLOOSE]:i[s.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new d(r[2],this.options.loose):this.semver=n}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===n||e===n)return!0;if("string"==typeof e)try{e=new d(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof a))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new u(e.value,t).test(this.value):""===e.operator?""===e.value||new u(this.value,t).test(e.semver):!((t=o(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}e.exports=a;const o=r(3365),{safeRe:i,t:s}=r(1680),l=r(5373),c=r(202),d=r(6262),u=r(2717)},2717:(e,t,r)=>{const n=/\s+/g;class a{constructor(e,t){if(t=i(t),e instanceof a)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new a(e.raw,t);if(e instanceof s)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(n," "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!v(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&y(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&f)|(this.options.loose&&g))+":"+e,r=o.get(t);if(r)return r;const n=this.options.loose,a=n?d[u.HYPHENRANGELOOSE]:d[u.HYPHENRANGE];e=e.replace(a,A(this.options.includePrerelease)),l("hyphen replace",e),e=e.replace(d[u.COMPARATORTRIM],p),l("comparator trim",e),e=e.replace(d[u.TILDETRIM],h),l("tilde trim",e),e=e.replace(d[u.CARETTRIM],m),l("caret trim",e);let i=e.split(" ").map((e=>_(e,this.options))).join(" ").split(/\s+/).map((e=>T(e,this.options)));n&&(i=i.filter((e=>(l("loose invalid filter",e,this.options),!!e.match(d[u.COMPARATORLOOSE]))))),l("range list",i);const c=new Map,y=i.map((e=>new s(e,this.options)));for(const e of y){if(v(e))return[e];c.set(e.value,e)}c.size>1&&c.has("")&&c.delete("");const b=[...c.values()];return o.set(t,b),b}intersects(e,t){if(!(e instanceof a))throw new TypeError("a Range is required");return this.set.some((r=>b(r,t)&&e.set.some((e=>b(e,t)&&r.every((r=>e.every((e=>r.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(P(this.set[t],e,this.options))return!0;return!1}}e.exports=a;const o=new(r(7540)),i=r(3365),s=r(3274),l=r(202),c=r(6262),{safeRe:d,t:u,comparatorTrimReplace:p,tildeTrimReplace:h,caretTrimReplace:m}=r(1680),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:g}=r(7628),v=e=>"<0.0.0-0"===e.value,y=e=>""===e.value,b=(e,t)=>{let r=!0;const n=e.slice();let a=n.pop();for(;r&&n.length;)r=n.every((e=>a.intersects(e,t))),a=n.pop();return r},_=(e,t)=>(l("comp",e,t),e=O(e,t),l("caret",e),e=w(e,t),l("tildes",e),e=S(e,t),l("xrange",e),e=I(e,t),l("stars",e),e),E=e=>!e||"x"===e.toLowerCase()||"*"===e,w=(e,t)=>e.trim().split(/\s+/).map((e=>x(e,t))).join(" "),x=(e,t)=>{const r=t.loose?d[u.TILDELOOSE]:d[u.TILDE];return e.replace(r,((t,r,n,a,o)=>{let i;return l("tilde",e,t,r,n,a,o),E(r)?i="":E(n)?i=`>=${r}.0.0 <${+r+1}.0.0-0`:E(a)?i=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:o?(l("replaceTilde pr",o),i=`>=${r}.${n}.${a}-${o} <${r}.${+n+1}.0-0`):i=`>=${r}.${n}.${a} <${r}.${+n+1}.0-0`,l("tilde return",i),i}))},O=(e,t)=>e.trim().split(/\s+/).map((e=>k(e,t))).join(" "),k=(e,t)=>{l("caret",e,t);const r=t.loose?d[u.CARETLOOSE]:d[u.CARET],n=t.includePrerelease?"-0":"";return e.replace(r,((t,r,a,o,i)=>{let s;return l("caret",e,t,r,a,o,i),E(r)?s="":E(a)?s=`>=${r}.0.0${n} <${+r+1}.0.0-0`:E(o)?s="0"===r?`>=${r}.${a}.0${n} <${r}.${+a+1}.0-0`:`>=${r}.${a}.0${n} <${+r+1}.0.0-0`:i?(l("replaceCaret pr",i),s="0"===r?"0"===a?`>=${r}.${a}.${o}-${i} <${r}.${a}.${+o+1}-0`:`>=${r}.${a}.${o}-${i} <${r}.${+a+1}.0-0`:`>=${r}.${a}.${o}-${i} <${+r+1}.0.0-0`):(l("no pr"),s="0"===r?"0"===a?`>=${r}.${a}.${o}${n} <${r}.${a}.${+o+1}-0`:`>=${r}.${a}.${o}${n} <${r}.${+a+1}.0-0`:`>=${r}.${a}.${o} <${+r+1}.0.0-0`),l("caret return",s),s}))},S=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map((e=>C(e,t))).join(" ")),C=(e,t)=>{e=e.trim();const r=t.loose?d[u.XRANGELOOSE]:d[u.XRANGE];return e.replace(r,((r,n,a,o,i,s)=>{l("xRange",e,r,n,a,o,i,s);const c=E(a),d=c||E(o),u=d||E(i),p=u;return"="===n&&p&&(n=""),s=t.includePrerelease?"-0":"",c?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&p?(d&&(o=0),i=0,">"===n?(n=">=",d?(a=+a+1,o=0,i=0):(o=+o+1,i=0)):"<="===n&&(n="<",d?a=+a+1:o=+o+1),"<"===n&&(s="-0"),r=`${n+a}.${o}.${i}${s}`):d?r=`>=${a}.0.0${s} <${+a+1}.0.0-0`:u&&(r=`>=${a}.${o}.0${s} <${a}.${+o+1}.0-0`),l("xRange return",r),r}))},I=(e,t)=>(l("replaceStars",e,t),e.trim().replace(d[u.STAR],"")),T=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(d[t.includePrerelease?u.GTE0PRE:u.GTE0],"")),A=e=>(t,r,n,a,o,i,s,l,c,d,u,p)=>`${r=E(n)?"":E(a)?`>=${n}.0.0${e?"-0":""}`:E(o)?`>=${n}.${a}.0${e?"-0":""}`:i?`>=${r}`:`>=${r}${e?"-0":""}`} ${l=E(c)?"":E(d)?`<${+c+1}.0.0-0`:E(u)?`<${c}.${+d+1}.0-0`:p?`<=${c}.${d}.${u}-${p}`:e?`<${c}.${d}.${+u+1}-0`:`<=${l}`}`.trim(),P=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==s.ANY&&e[r].semver.prerelease.length>0){const n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}},6262:(e,t,r)=>{const n=r(202),{MAX_LENGTH:a,MAX_SAFE_INTEGER:o}=r(7628),{safeRe:i,t:s}=r(1680),l=r(3365),{compareIdentifiers:c}=r(9525);class d{constructor(e,t){if(t=l(t),e instanceof d){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>a)throw new TypeError(`version is longer than ${a} characters`);n("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?i[s.LOOSE]:i[s.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<o)return t}return e})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(n("SemVer.compare",this.version,this.options,e),!(e instanceof d)){if("string"==typeof e&&e===this.version)return 0;e=new d(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof d||(e=new d(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof d||(e=new d(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],a=e.prerelease[t];if(n("prerelease compare",t,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return-1;if(r!==a)return c(r,a)}while(++t)}compareBuild(e){e instanceof d||(e=new d(e,this.options));let t=0;do{const r=this.build[t],a=e.build[t];if(n("build compare",t,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return-1;if(r!==a)return c(r,a)}while(++t)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===r&&(n=[t]),0===c(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=d},3344:(e,t,r)=>{const n=r(7738);e.exports=(e,t)=>{const r=n(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},5373:(e,t,r)=>{const n=r(3623),a=r(5477),o=r(1694),i=r(8327),s=r(7665),l=r(2658);e.exports=(e,t,r,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return n(e,r,c);case"!=":return a(e,r,c);case">":return o(e,r,c);case">=":return i(e,r,c);case"<":return s(e,r,c);case"<=":return l(e,r,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},4768:(e,t,r)=>{const n=r(6262),a=r(7738),{safeRe:o,t:i}=r(1680);e.exports=(e,t)=>{if(e instanceof n)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){const n=t.includePrerelease?o[i.COERCERTLFULL]:o[i.COERCERTL];let a;for(;(a=n.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&a.index+a[0].length===r.index+r[0].length||(r=a),n.lastIndex=a.index+a[1].length+a[2].length;n.lastIndex=-1}else r=e.match(t.includePrerelease?o[i.COERCEFULL]:o[i.COERCE]);if(null===r)return null;const s=r[2],l=r[3]||"0",c=r[4]||"0",d=t.includePrerelease&&r[5]?`-${r[5]}`:"",u=t.includePrerelease&&r[6]?`+${r[6]}`:"";return a(`${s}.${l}.${c}${d}${u}`,t)}},887:(e,t,r)=>{const n=r(6262);e.exports=(e,t,r)=>{const a=new n(e,r),o=new n(t,r);return a.compare(o)||a.compareBuild(o)}},6413:(e,t,r)=>{const n=r(4774);e.exports=(e,t)=>n(e,t,!0)},4774:(e,t,r)=>{const n=r(6262);e.exports=(e,t,r)=>new n(e,r).compare(new n(t,r))},6390:(e,t,r)=>{const n=r(7738);e.exports=(e,t)=>{const r=n(e,null,!0),a=n(t,null,!0),o=r.compare(a);if(0===o)return null;const i=o>0,s=i?r:a,l=i?a:r,c=!!s.prerelease.length;if(l.prerelease.length&&!c)return l.patch||l.minor?s.patch?"patch":s.minor?"minor":"major":"major";const d=c?"pre":"";return r.major!==a.major?d+"major":r.minor!==a.minor?d+"minor":r.patch!==a.patch?d+"patch":"prerelease"}},3623:(e,t,r)=>{const n=r(4774);e.exports=(e,t,r)=>0===n(e,t,r)},1694:(e,t,r)=>{const n=r(4774);e.exports=(e,t,r)=>n(e,t,r)>0},8327:(e,t,r)=>{const n=r(4774);e.exports=(e,t,r)=>n(e,t,r)>=0},9489:(e,t,r)=>{const n=r(6262);e.exports=(e,t,r,a,o)=>{"string"==typeof r&&(o=a,a=r,r=void 0);try{return new n(e instanceof n?e.version:e,r).inc(t,a,o).version}catch(e){return null}}},7665:(e,t,r)=>{const n=r(4774);e.exports=(e,t,r)=>n(e,t,r)<0},2658:(e,t,r)=>{const n=r(4774);e.exports=(e,t,r)=>n(e,t,r)<=0},40:(e,t,r)=>{const n=r(6262);e.exports=(e,t)=>new n(e,t).major},4084:(e,t,r)=>{const n=r(6262);e.exports=(e,t)=>new n(e,t).minor},5477:(e,t,r)=>{const n=r(4774);e.exports=(e,t,r)=>0!==n(e,t,r)},7738:(e,t,r)=>{const n=r(6262);e.exports=(e,t,r=!1)=>{if(e instanceof n)return e;try{return new n(e,t)}catch(e){if(!r)return null;throw e}}},8187:(e,t,r)=>{const n=r(6262);e.exports=(e,t)=>new n(e,t).patch},5179:(e,t,r)=>{const n=r(7738);e.exports=(e,t)=>{const r=n(e,t);return r&&r.prerelease.length?r.prerelease:null}},5104:(e,t,r)=>{const n=r(4774);e.exports=(e,t,r)=>n(t,e,r)},3399:(e,t,r)=>{const n=r(887);e.exports=(e,t)=>e.sort(((e,r)=>n(r,e,t)))},3376:(e,t,r)=>{const n=r(2717);e.exports=(e,t,r)=>{try{t=new n(t,r)}catch(e){return!1}return t.test(e)}},5513:(e,t,r)=>{const n=r(887);e.exports=(e,t)=>e.sort(((e,r)=>n(e,r,t)))},3263:(e,t,r)=>{const n=r(7738);e.exports=(e,t)=>{const r=n(e,t);return r?r.version:null}},143:(e,t,r)=>{const n=r(1680),a=r(7628),o=r(6262),i=r(9525),s=r(7738),l=r(3263),c=r(3344),d=r(9489),u=r(6390),p=r(40),h=r(4084),m=r(8187),f=r(5179),g=r(4774),v=r(5104),y=r(6413),b=r(887),_=r(5513),E=r(3399),w=r(1694),x=r(7665),O=r(3623),k=r(5477),S=r(8327),C=r(2658),I=r(5373),T=r(4768),A=r(3274),P=r(2717),$=r(3376),j=r(205),R=r(7170),L=r(1896),N=r(2259),M=r(724),D=r(2033),F=r(6761),Z=r(8432),z=r(1114),U=r(1039),q=r(110);e.exports={parse:s,valid:l,clean:c,inc:d,diff:u,major:p,minor:h,patch:m,prerelease:f,compare:g,rcompare:v,compareLoose:y,compareBuild:b,sort:_,rsort:E,gt:w,lt:x,eq:O,neq:k,gte:S,lte:C,cmp:I,coerce:T,Comparator:A,Range:P,satisfies:$,toComparators:j,maxSatisfying:R,minSatisfying:L,minVersion:N,validRange:M,outside:D,gtr:F,ltr:Z,intersects:z,simplifyRange:U,subset:q,SemVer:o,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:a.SEMVER_SPEC_VERSION,RELEASE_TYPES:a.RELEASE_TYPES,compareIdentifiers:i.compareIdentifiers,rcompareIdentifiers:i.rcompareIdentifiers}},7628:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},202:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},9525:e=>{const t=/^[0-9]+$/,r=(e,r)=>{const n=t.test(e),a=t.test(r);return n&&a&&(e=+e,r=+r),e===r?0:n&&!a?-1:a&&!n?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},7540:e=>{e.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},3365:e=>{const t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},1680:(e,t,r)=>{const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_LENGTH:o}=r(7628),i=r(202),s=(t=e.exports={}).re=[],l=t.safeRe=[],c=t.src=[],d=t.t={};let u=0;const p="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",o],[p,a]],m=(e,t,r)=>{const n=(e=>{for(const[t,r]of h)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),a=u++;i(e,a,t),d[e]=a,c[a]=t,s[a]=new RegExp(t,r?"g":void 0),l[a]=new RegExp(n,r?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),m("MAINVERSION",`(${c[d.NUMERICIDENTIFIER]})\\.(${c[d.NUMERICIDENTIFIER]})\\.(${c[d.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${c[d.NUMERICIDENTIFIERLOOSE]})\\.(${c[d.NUMERICIDENTIFIERLOOSE]})\\.(${c[d.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${c[d.NUMERICIDENTIFIER]}|${c[d.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${c[d.NUMERICIDENTIFIERLOOSE]}|${c[d.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${c[d.PRERELEASEIDENTIFIER]}(?:\\.${c[d.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${c[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[d.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${p}+`),m("BUILD",`(?:\\+(${c[d.BUILDIDENTIFIER]}(?:\\.${c[d.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${c[d.MAINVERSION]}${c[d.PRERELEASE]}?${c[d.BUILD]}?`),m("FULL",`^${c[d.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${c[d.MAINVERSIONLOOSE]}${c[d.PRERELEASELOOSE]}?${c[d.BUILD]}?`),m("LOOSE",`^${c[d.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${c[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${c[d.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${c[d.XRANGEIDENTIFIER]})(?:\\.(${c[d.XRANGEIDENTIFIER]})(?:\\.(${c[d.XRANGEIDENTIFIER]})(?:${c[d.PRERELEASE]})?${c[d.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${c[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[d.XRANGEIDENTIFIERLOOSE]})(?:${c[d.PRERELEASELOOSE]})?${c[d.BUILD]}?)?)?`),m("XRANGE",`^${c[d.GTLT]}\\s*${c[d.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${c[d.GTLT]}\\s*${c[d.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),m("COERCE",`${c[d.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",c[d.COERCEPLAIN]+`(?:${c[d.PRERELEASE]})?`+`(?:${c[d.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",c[d.COERCE],!0),m("COERCERTLFULL",c[d.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${c[d.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${c[d.LONETILDE]}${c[d.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${c[d.LONETILDE]}${c[d.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${c[d.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${c[d.LONECARET]}${c[d.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${c[d.LONECARET]}${c[d.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${c[d.GTLT]}\\s*(${c[d.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${c[d.GTLT]}\\s*(${c[d.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${c[d.GTLT]}\\s*(${c[d.LOOSEPLAIN]}|${c[d.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${c[d.XRANGEPLAIN]})\\s+-\\s+(${c[d.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${c[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[d.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},6761:(e,t,r)=>{const n=r(2033);e.exports=(e,t,r)=>n(e,t,">",r)},1114:(e,t,r)=>{const n=r(2717);e.exports=(e,t,r)=>(e=new n(e,r),t=new n(t,r),e.intersects(t,r))},8432:(e,t,r)=>{const n=r(2033);e.exports=(e,t,r)=>n(e,t,"<",r)},7170:(e,t,r)=>{const n=r(6262),a=r(2717);e.exports=(e,t,r)=>{let o=null,i=null,s=null;try{s=new a(t,r)}catch(e){return null}return e.forEach((e=>{s.test(e)&&(o&&-1!==i.compare(e)||(o=e,i=new n(o,r)))})),o}},1896:(e,t,r)=>{const n=r(6262),a=r(2717);e.exports=(e,t,r)=>{let o=null,i=null,s=null;try{s=new a(t,r)}catch(e){return null}return e.forEach((e=>{s.test(e)&&(o&&1!==i.compare(e)||(o=e,i=new n(o,r)))})),o}},2259:(e,t,r)=>{const n=r(6262),a=r(2717),o=r(1694);e.exports=(e,t)=>{e=new a(e,t);let r=new n("0.0.0");if(e.test(r))return r;if(r=new n("0.0.0-0"),e.test(r))return r;r=null;for(let t=0;t<e.set.length;++t){const a=e.set[t];let i=null;a.forEach((e=>{const t=new n(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!o(t,i)||(i=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!i||r&&!o(r,i)||(r=i)}return r&&e.test(r)?r:null}},2033:(e,t,r)=>{const n=r(6262),a=r(3274),{ANY:o}=a,i=r(2717),s=r(3376),l=r(1694),c=r(7665),d=r(2658),u=r(8327);e.exports=(e,t,r,p)=>{let h,m,f,g,v;switch(e=new n(e,p),t=new i(t,p),r){case">":h=l,m=d,f=c,g=">",v=">=";break;case"<":h=c,m=u,f=l,g="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(e,t,p))return!1;for(let r=0;r<t.set.length;++r){const n=t.set[r];let i=null,s=null;if(n.forEach((e=>{e.semver===o&&(e=new a(">=0.0.0")),i=i||e,s=s||e,h(e.semver,i.semver,p)?i=e:f(e.semver,s.semver,p)&&(s=e)})),i.operator===g||i.operator===v)return!1;if((!s.operator||s.operator===g)&&m(e,s.semver))return!1;if(s.operator===v&&f(e,s.semver))return!1}return!0}},1039:(e,t,r)=>{const n=r(3376),a=r(4774);e.exports=(e,t,r)=>{const o=[];let i=null,s=null;const l=e.sort(((e,t)=>a(e,t,r)));for(const e of l)n(e,t,r)?(s=e,i||(i=e)):(s&&o.push([i,s]),s=null,i=null);i&&o.push([i,null]);const c=[];for(const[e,t]of o)e===t?c.push(e):t||e!==l[0]?t?e===l[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");const d=c.join(" || "),u="string"==typeof t.raw?t.raw:String(t);return d.length<u.length?d:t}},110:(e,t,r)=>{const n=r(2717),a=r(3274),{ANY:o}=a,i=r(3376),s=r(4774),l=[new a(">=0.0.0-0")],c=[new a(">=0.0.0")],d=(e,t,r)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===o){if(1===t.length&&t[0].semver===o)return!0;e=r.includePrerelease?l:c}if(1===t.length&&t[0].semver===o){if(r.includePrerelease)return!0;t=c}const n=new Set;let a,d,h,m,f,g,v;for(const t of e)">"===t.operator||">="===t.operator?a=u(a,t,r):"<"===t.operator||"<="===t.operator?d=p(d,t,r):n.add(t.semver);if(n.size>1)return null;if(a&&d){if(h=s(a.semver,d.semver,r),h>0)return null;if(0===h&&(">="!==a.operator||"<="!==d.operator))return null}for(const e of n){if(a&&!i(e,String(a),r))return null;if(d&&!i(e,String(d),r))return null;for(const n of t)if(!i(e,String(n),r))return!1;return!0}let y=!(!d||r.includePrerelease||!d.semver.prerelease.length)&&d.semver,b=!(!a||r.includePrerelease||!a.semver.prerelease.length)&&a.semver;y&&1===y.prerelease.length&&"<"===d.operator&&0===y.prerelease[0]&&(y=!1);for(const e of t){if(v=v||">"===e.operator||">="===e.operator,g=g||"<"===e.operator||"<="===e.operator,a)if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),">"===e.operator||">="===e.operator){if(m=u(a,e,r),m===e&&m!==a)return!1}else if(">="===a.operator&&!i(a.semver,String(e),r))return!1;if(d)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),"<"===e.operator||"<="===e.operator){if(f=p(d,e,r),f===e&&f!==d)return!1}else if("<="===d.operator&&!i(d.semver,String(e),r))return!1;if(!e.operator&&(d||a)&&0!==h)return!1}return!(a&&g&&!d&&0!==h||d&&v&&!a&&0!==h||b||y)},u=(e,t,r)=>{if(!e)return t;const n=s(e.semver,t.semver,r);return n>0?e:n<0||">"===t.operator&&">="===e.operator?t:e},p=(e,t,r)=>{if(!e)return t;const n=s(e.semver,t.semver,r);return n<0?e:n>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new n(e,r),t=new n(t,r);let a=!1;e:for(const n of e.set){for(const e of t.set){const t=d(n,e,r);if(a=a||null!==t,t)continue e}if(a)return!1}return!0}},205:(e,t,r)=>{const n=r(2717);e.exports=(e,t)=>new n(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},724:(e,t,r)=>{const n=r(2717);e.exports=(e,t)=>{try{return new n(e,t).range||"*"}catch(e){return null}}},6089:e=>{"use strict";e.exports=o},7781:t=>{"use strict";t.exports=e},8531:e=>{"use strict";e.exports=r},2007:e=>{"use strict";e.exports=n},5959:e=>{"use strict";e.exports=t},1269:e=>{"use strict";e.exports=a}},s={};function l(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={exports:{}};return i[e](r,r.exports,l),r.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};return(()=>{"use strict";l.r(c),l.d(c,{plugin:()=>bi});var e=l(7781),t=l(5959),r=l.n(t);const n={appConfig:{container:"ac-container",provider:"ac-provider",openAIKey:"ac-openai-api-key",customizeOpenAIApiPath:"ac-customize-openai-api-path",openAIApiPath:"ac-openai-api-path",openAIOrganizationID:"ac-openai-api-organization-id",openAIUrl:"ac-openai-api-url",anthropicKey:"ac-anthropic-api-key",anthropicUrl:"ac-anthropic-api-url",vectorEnabled:"ac-vector-enabled",qdrantAddress:"ac-qdrant-address",qdrantSecure:"ac-qdrant-secure",qdrantApiKey:"ac-qdrant-api-key",grafanaVectorApiUrl:"ac-grafana-vector-api-url",model:"ac-vector-model",submit:"ac-submit-form",basicAuthUsername:"ac-basic-auth-username",basicAuthPassword:"ac-basic-auth-password"},mainPage:{container:"main-page-container"},models:{container:"models-container"},mcpTools:{container:"mcp-tools-container",disabled:"mcp-tools-disabled",loading:"mcp-tools-loading",error:"mcp-tools-error",empty:"mcp-tools-empty",list:"mcp-tools-list",toolItem:"mcp-tools-tool-item",toolName:"mcp-tools-tool-name",toolDescription:"mcp-tools-tool-description"}};var a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},a(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var i=function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},i.apply(this,arguments)};function s(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function d(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,o=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i}function u(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))}function p(e,r){void 0===r&&(r=[]);var n=function(e,r,n){void 0===r&&(r=[]),void 0===n&&(n={loading:!1});var a,o,s=(0,t.useRef)(0),l=(a=(0,t.useRef)(!1),o=(0,t.useCallback)((function(){return a.current}),[]),(0,t.useEffect)((function(){return a.current=!0,function(){a.current=!1}}),[]),o),c=(0,t.useState)(n),d=c[0],u=c[1],p=(0,t.useCallback)((function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=++s.current;return d.loading||u((function(e){return i(i({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return l()&&n===s.current&&u({value:e,loading:!1}),e}),(function(e){return l()&&n===s.current&&u({error:e,loading:!1}),e}))}),r);return[d,p]}(e,r,{loading:!0}),a=n[0],o=n[1];return(0,t.useEffect)((function(){o()}),[o]),a}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var h,m,f=l(8531);function g(){const{error:e,loading:t,value:a}=p((()=>(0,f.getBackendSrv)().get("api/plugins/grafana-llm-app/resources/openai/v1/models")));return t?r().createElement("div",{"data-testid":n.models.container},r().createElement("span",null,"Loading...")):e||!a?r().createElement("div",{"data-testid":n.models.container},r().createElement("span",null,"Error loading models: ",null==e?void 0:e.message)):r().createElement("div",{"data-testid":n.models.container},r().createElement("h1",null,"Available Models"),r().createElement("pre",null,JSON.stringify(a,null,2)))}!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),n={};for(const e of r)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(h||(h={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(m||(m={}));const v=h.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),y=e=>{switch(typeof e){case"undefined":return v.undefined;case"string":return v.string;case"number":return isNaN(e)?v.nan:v.number;case"boolean":return v.boolean;case"function":return v.function;case"bigint":return v.bigint;case"symbol":return v.symbol;case"object":return Array.isArray(e)?v.array:null===e?v.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?v.promise:"undefined"!=typeof Map&&e instanceof Map?v.map:"undefined"!=typeof Set&&e instanceof Set?v.set:"undefined"!=typeof Date&&e instanceof Date?v.date:v.object;default:return v.unknown}},b=h.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class _ extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(const a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(n);else if("invalid_return_type"===a.code)n(a.returnTypeError);else if("invalid_arguments"===a.code)n(a.argumentsError);else if(0===a.path.length)r._errors.push(t(a));else{let e=r,n=0;for(;n<a.path.length;){const r=a.path[n];n===a.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(a))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}static assert(e){if(!(e instanceof _))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,h.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},r=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}_.create=e=>new _(e);const E=(e,t)=>{let r;switch(e.code){case b.invalid_type:r=e.received===v.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case b.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,h.jsonStringifyReplacer)}`;break;case b.unrecognized_keys:r=`Unrecognized key(s) in object: ${h.joinValues(e.keys,", ")}`;break;case b.invalid_union:r="Invalid input";break;case b.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${h.joinValues(e.options)}`;break;case b.invalid_enum_value:r=`Invalid enum value. Expected ${h.joinValues(e.options)}, received '${e.received}'`;break;case b.invalid_arguments:r="Invalid function arguments";break;case b.invalid_return_type:r="Invalid function return type";break;case b.invalid_date:r="Invalid date";break;case b.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:h.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case b.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case b.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case b.custom:r="Invalid input";break;case b.invalid_intersection_types:r="Intersection results could not be merged";break;case b.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case b.not_finite:r="Number must be finite";break;default:r=t.defaultError,h.assertNever(e)}return{message:r}};let w=E;function x(){return w}const O=e=>{const{data:t,path:r,errorMaps:n,issueData:a}=e,o=[...r,...a.path||[]],i={...a,path:o};if(void 0!==a.message)return{...a,path:o,message:a.message};let s="";const l=n.filter((e=>!!e)).slice().reverse();for(const e of l)s=e(i,{data:t,defaultError:s}).message;return{...a,path:o,message:s}};function k(e,t){const r=x(),n=O({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===E?void 0:E].filter((e=>!!e))});e.common.issues.push(n)}class S{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const n of t){if("aborted"===n.status)return C;"dirty"===n.status&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const e of t){const t=await e.key,n=await e.value;r.push({key:t,value:n})}return S.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const n of t){const{key:t,value:a}=n;if("aborted"===t.status)return C;if("aborted"===a.status)return C;"dirty"===t.status&&e.dirty(),"dirty"===a.status&&e.dirty(),"__proto__"===t.value||void 0===a.value&&!n.alwaysSet||(r[t.value]=a.value)}return{status:e.value,value:r}}}const C=Object.freeze({status:"aborted"}),I=e=>({status:"dirty",value:e}),T=e=>({status:"valid",value:e}),A=e=>"aborted"===e.status,P=e=>"dirty"===e.status,$=e=>"valid"===e.status,j=e=>"undefined"!=typeof Promise&&e instanceof Promise;function R(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function L(e,t,r,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,r):a?a.value=r:t.set(e,r),r}var N,M,D;"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(N||(N={}));class F{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Z=(e,t)=>{if($(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new _(e.common.issues);return this._error=t,this._error}}};function z(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:a}=e;if(t&&(r||n))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:a}:{errorMap:(t,a)=>{var o,i;const{message:s}=e;return"invalid_enum_value"===t.code?{message:null!=s?s:a.defaultError}:void 0===a.data?{message:null!==(o=null!=s?s:n)&&void 0!==o?o:a.defaultError}:"invalid_type"!==t.code?{message:a.defaultError}:{message:null!==(i=null!=s?s:r)&&void 0!==i?i:a.defaultError}},description:a}}class U{get description(){return this._def.description}_getType(e){return y(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:y(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new S,ctx:{common:e.parent.common,data:e.data,parsedType:y(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(j(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const n={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:y(e)},a=this._parseSync({data:e,path:n.path,parent:n});return Z(n,a)}"~validate"(e){var t,r;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:y(e)};if(!this["~standard"].async)try{const t=this._parseSync({data:e,path:[],parent:n});return $(t)?{value:t.value}:{issues:n.common.issues}}catch(e){(null===(r=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase())||void 0===r?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then((e=>$(e)?{value:e.value}:{issues:n.common.issues}))}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:y(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await(j(n)?n:Promise.resolve(n));return Z(r,a)}refine(e,t){const r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,n)=>{const a=e(t),o=()=>n.addIssue({code:b.custom,...r(t)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then((e=>!!e||(o(),!1))):!!a||(o(),!1)}))}refinement(e,t){return this._refinement(((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1)))}_refinement(e){return new Ue({schema:this,typeName:tt.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return qe.create(this,this._def)}nullable(){return Ve.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return xe.create(this)}promise(){return ze.create(this,this._def)}or(e){return Se.create([this,e],this._def)}and(e){return Ae.create(this,e,this._def)}transform(e){return new Ue({...z(this._def),schema:this,typeName:tt.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Ge({...z(this._def),innerType:this,defaultValue:t,typeName:tt.ZodDefault})}brand(){return new Ke({typeName:tt.ZodBranded,type:this,...z(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Be({...z(this._def),innerType:this,catchValue:t,typeName:tt.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Xe.create(this,e)}readonly(){return Je.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const q=/^c[^\s-]{8,}$/i,V=/^[0-9a-z]+$/,G=/^[0-9A-HJKMNP-TV-Z]{26}$/i,B=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,H=/^[a-z0-9_-]{21}$/i,W=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,K=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,X=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let J;const Y=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Q=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ee=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,te=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,re=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ne=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ae="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",oe=new RegExp(`^${ae}$`);function ie(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function se(e){let t=`${ae}T${ie(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function le(e,t){if(!W.test(e))return!1;try{const[r]=e.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),a=JSON.parse(atob(n));return!("object"!=typeof a||null===a||!a.typ||!a.alg||t&&a.alg!==t)}catch(e){return!1}}function ce(e,t){return!("v4"!==t&&t||!Q.test(e))||!("v6"!==t&&t||!te.test(e))}class de extends U{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==v.string){const t=this._getOrReturnCtx(e);return k(t,{code:b.invalid_type,expected:v.string,received:t.parsedType}),C}const t=new S;let r;for(const o of this._def.checks)if("min"===o.kind)e.data.length<o.value&&(r=this._getOrReturnCtx(e,r),k(r,{code:b.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),t.dirty());else if("max"===o.kind)e.data.length>o.value&&(r=this._getOrReturnCtx(e,r),k(r,{code:b.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),t.dirty());else if("length"===o.kind){const n=e.data.length>o.value,a=e.data.length<o.value;(n||a)&&(r=this._getOrReturnCtx(e,r),n?k(r,{code:b.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):a&&k(r,{code:b.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),t.dirty())}else if("email"===o.kind)X.test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"email",code:b.invalid_string,message:o.message}),t.dirty());else if("emoji"===o.kind)J||(J=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),J.test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"emoji",code:b.invalid_string,message:o.message}),t.dirty());else if("uuid"===o.kind)B.test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"uuid",code:b.invalid_string,message:o.message}),t.dirty());else if("nanoid"===o.kind)H.test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"nanoid",code:b.invalid_string,message:o.message}),t.dirty());else if("cuid"===o.kind)q.test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"cuid",code:b.invalid_string,message:o.message}),t.dirty());else if("cuid2"===o.kind)V.test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"cuid2",code:b.invalid_string,message:o.message}),t.dirty());else if("ulid"===o.kind)G.test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"ulid",code:b.invalid_string,message:o.message}),t.dirty());else if("url"===o.kind)try{new URL(e.data)}catch(n){r=this._getOrReturnCtx(e,r),k(r,{validation:"url",code:b.invalid_string,message:o.message}),t.dirty()}else"regex"===o.kind?(o.regex.lastIndex=0,o.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"regex",code:b.invalid_string,message:o.message}),t.dirty())):"trim"===o.kind?e.data=e.data.trim():"includes"===o.kind?e.data.includes(o.value,o.position)||(r=this._getOrReturnCtx(e,r),k(r,{code:b.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),t.dirty()):"toLowerCase"===o.kind?e.data=e.data.toLowerCase():"toUpperCase"===o.kind?e.data=e.data.toUpperCase():"startsWith"===o.kind?e.data.startsWith(o.value)||(r=this._getOrReturnCtx(e,r),k(r,{code:b.invalid_string,validation:{startsWith:o.value},message:o.message}),t.dirty()):"endsWith"===o.kind?e.data.endsWith(o.value)||(r=this._getOrReturnCtx(e,r),k(r,{code:b.invalid_string,validation:{endsWith:o.value},message:o.message}),t.dirty()):"datetime"===o.kind?se(o).test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{code:b.invalid_string,validation:"datetime",message:o.message}),t.dirty()):"date"===o.kind?oe.test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{code:b.invalid_string,validation:"date",message:o.message}),t.dirty()):"time"===o.kind?new RegExp(`^${ie(o)}$`).test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{code:b.invalid_string,validation:"time",message:o.message}),t.dirty()):"duration"===o.kind?K.test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"duration",code:b.invalid_string,message:o.message}),t.dirty()):"ip"===o.kind?(n=e.data,("v4"!==(a=o.version)&&a||!Y.test(n))&&("v6"!==a&&a||!ee.test(n))&&(r=this._getOrReturnCtx(e,r),k(r,{validation:"ip",code:b.invalid_string,message:o.message}),t.dirty())):"jwt"===o.kind?le(e.data,o.alg)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"jwt",code:b.invalid_string,message:o.message}),t.dirty()):"cidr"===o.kind?ce(e.data,o.version)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"cidr",code:b.invalid_string,message:o.message}),t.dirty()):"base64"===o.kind?re.test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"base64",code:b.invalid_string,message:o.message}),t.dirty()):"base64url"===o.kind?ne.test(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{validation:"base64url",code:b.invalid_string,message:o.message}),t.dirty()):h.assertNever(o);var n,a;return{status:t.value,value:e.data}}_regex(e,t,r){return this.refinement((t=>e.test(t)),{validation:t,code:b.invalid_string,...N.errToObj(r)})}_addCheck(e){return new de({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...N.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...N.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...N.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...N.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...N.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...N.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...N.errToObj(t)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new de({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new de({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new de({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isCIDR(){return!!this._def.checks.find((e=>"cidr"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get isBase64url(){return!!this._def.checks.find((e=>"base64url"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function ue(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,a=r>n?r:n;return parseInt(e.toFixed(a).replace(".",""))%parseInt(t.toFixed(a).replace(".",""))/Math.pow(10,a)}de.create=e=>{var t;return new de({checks:[],typeName:tt.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...z(e)})};class pe extends U{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==v.number){const t=this._getOrReturnCtx(e);return k(t,{code:b.invalid_type,expected:v.number,received:t.parsedType}),C}let t;const r=new S;for(const n of this._def.checks)"int"===n.kind?h.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),k(t,{code:b.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),k(t,{code:b.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),k(t,{code:b.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==ue(e.data,n.value)&&(t=this._getOrReturnCtx(e,t),k(t,{code:b.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),k(t,{code:b.not_finite,message:n.message}),r.dirty()):h.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,N.toString(t))}gt(e,t){return this.setLimit("min",e,!1,N.toString(t))}lte(e,t){return this.setLimit("max",e,!0,N.toString(t))}lt(e,t){return this.setLimit("max",e,!1,N.toString(t))}setLimit(e,t,r,n){return new pe({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:N.toString(n)}]})}_addCheck(e){return new pe({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&h.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}pe.create=e=>new pe({checks:[],typeName:tt.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...z(e)});class he extends U{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==v.bigint)return this._getInvalidInput(e);let t;const r=new S;for(const n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),k(t,{code:b.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),k(t,{code:b.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),k(t,{code:b.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):h.assertNever(n);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return k(t,{code:b.invalid_type,expected:v.bigint,received:t.parsedType}),C}gte(e,t){return this.setLimit("min",e,!0,N.toString(t))}gt(e,t){return this.setLimit("min",e,!1,N.toString(t))}lte(e,t){return this.setLimit("max",e,!0,N.toString(t))}lt(e,t){return this.setLimit("max",e,!1,N.toString(t))}setLimit(e,t,r,n){return new he({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:N.toString(n)}]})}_addCheck(e){return new he({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}he.create=e=>{var t;return new he({checks:[],typeName:tt.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...z(e)})};class me extends U{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==v.boolean){const t=this._getOrReturnCtx(e);return k(t,{code:b.invalid_type,expected:v.boolean,received:t.parsedType}),C}return T(e.data)}}me.create=e=>new me({typeName:tt.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...z(e)});class fe extends U{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==v.date){const t=this._getOrReturnCtx(e);return k(t,{code:b.invalid_type,expected:v.date,received:t.parsedType}),C}if(isNaN(e.data.getTime()))return k(this._getOrReturnCtx(e),{code:b.invalid_date}),C;const t=new S;let r;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(r=this._getOrReturnCtx(e,r),k(r,{code:b.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),t.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(r=this._getOrReturnCtx(e,r),k(r,{code:b.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),t.dirty()):h.assertNever(n);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new fe({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:N.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:N.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}fe.create=e=>new fe({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:tt.ZodDate,...z(e)});class ge extends U{_parse(e){if(this._getType(e)!==v.symbol){const t=this._getOrReturnCtx(e);return k(t,{code:b.invalid_type,expected:v.symbol,received:t.parsedType}),C}return T(e.data)}}ge.create=e=>new ge({typeName:tt.ZodSymbol,...z(e)});class ve extends U{_parse(e){if(this._getType(e)!==v.undefined){const t=this._getOrReturnCtx(e);return k(t,{code:b.invalid_type,expected:v.undefined,received:t.parsedType}),C}return T(e.data)}}ve.create=e=>new ve({typeName:tt.ZodUndefined,...z(e)});class ye extends U{_parse(e){if(this._getType(e)!==v.null){const t=this._getOrReturnCtx(e);return k(t,{code:b.invalid_type,expected:v.null,received:t.parsedType}),C}return T(e.data)}}ye.create=e=>new ye({typeName:tt.ZodNull,...z(e)});class be extends U{constructor(){super(...arguments),this._any=!0}_parse(e){return T(e.data)}}be.create=e=>new be({typeName:tt.ZodAny,...z(e)});class _e extends U{constructor(){super(...arguments),this._unknown=!0}_parse(e){return T(e.data)}}_e.create=e=>new _e({typeName:tt.ZodUnknown,...z(e)});class Ee extends U{_parse(e){const t=this._getOrReturnCtx(e);return k(t,{code:b.invalid_type,expected:v.never,received:t.parsedType}),C}}Ee.create=e=>new Ee({typeName:tt.ZodNever,...z(e)});class we extends U{_parse(e){if(this._getType(e)!==v.undefined){const t=this._getOrReturnCtx(e);return k(t,{code:b.invalid_type,expected:v.void,received:t.parsedType}),C}return T(e.data)}}we.create=e=>new we({typeName:tt.ZodVoid,...z(e)});class xe extends U{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==v.array)return k(t,{code:b.invalid_type,expected:v.array,received:t.parsedType}),C;if(null!==n.exactLength){const e=t.data.length>n.exactLength.value,a=t.data.length<n.exactLength.value;(e||a)&&(k(t,{code:e?b.too_big:b.too_small,minimum:a?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&(k(t,{code:b.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&(k(t,{code:b.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map(((e,r)=>n.type._parseAsync(new F(t,e,t.path,r))))).then((e=>S.mergeArray(r,e)));const a=[...t.data].map(((e,r)=>n.type._parseSync(new F(t,e,t.path,r))));return S.mergeArray(r,a)}get element(){return this._def.type}min(e,t){return new xe({...this._def,minLength:{value:e,message:N.toString(t)}})}max(e,t){return new xe({...this._def,maxLength:{value:e,message:N.toString(t)}})}length(e,t){return new xe({...this._def,exactLength:{value:e,message:N.toString(t)}})}nonempty(e){return this.min(1,e)}}function Oe(e){if(e instanceof ke){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=qe.create(Oe(n))}return new ke({...e._def,shape:()=>t})}return e instanceof xe?new xe({...e._def,type:Oe(e.element)}):e instanceof qe?qe.create(Oe(e.unwrap())):e instanceof Ve?Ve.create(Oe(e.unwrap())):e instanceof Pe?Pe.create(e.items.map((e=>Oe(e)))):e}xe.create=(e,t)=>new xe({type:e,minLength:null,maxLength:null,exactLength:null,typeName:tt.ZodArray,...z(t)});class ke extends U{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=h.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==v.object){const t=this._getOrReturnCtx(e);return k(t,{code:b.invalid_type,expected:v.object,received:t.parsedType}),C}const{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ee&&"strip"===this._def.unknownKeys))for(const e in r.data)a.includes(e)||o.push(e);const i=[];for(const e of a){const t=n[e],a=r.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new F(r,a,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof Ee){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of o)i.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)o.length>0&&(k(r,{code:b.unrecognized_keys,keys:o}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of o){const n=r.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new F(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of i){const r=await t.key,n=await t.value;e.push({key:r,value:n,alwaysSet:t.alwaysSet})}return e})).then((e=>S.mergeObjectSync(t,e))):S.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return N.errToObj,new ke({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var n,a,o,i;const s=null!==(o=null===(a=(n=this._def).errorMap)||void 0===a?void 0:a.call(n,t,r).message)&&void 0!==o?o:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(i=N.errToObj(e).message)&&void 0!==i?i:s}:{message:s}}}:{}})}strip(){return new ke({...this._def,unknownKeys:"strip"})}passthrough(){return new ke({...this._def,unknownKeys:"passthrough"})}extend(e){return new ke({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ke({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:tt.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ke({...this._def,catchall:e})}pick(e){const t={};return h.objectKeys(e).forEach((r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])})),new ke({...this._def,shape:()=>t})}omit(e){const t={};return h.objectKeys(this.shape).forEach((r=>{e[r]||(t[r]=this.shape[r])})),new ke({...this._def,shape:()=>t})}deepPartial(){return Oe(this)}partial(e){const t={};return h.objectKeys(this.shape).forEach((r=>{const n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()})),new ke({...this._def,shape:()=>t})}required(e){const t={};return h.objectKeys(this.shape).forEach((r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof qe;)e=e._def.innerType;t[r]=e}})),new ke({...this._def,shape:()=>t})}keyof(){return De(h.objectKeys(this.shape))}}ke.create=(e,t)=>new ke({shape:()=>e,unknownKeys:"strip",catchall:Ee.create(),typeName:tt.ZodObject,...z(t)}),ke.strictCreate=(e,t)=>new ke({shape:()=>e,unknownKeys:"strict",catchall:Ee.create(),typeName:tt.ZodObject,...z(t)}),ke.lazycreate=(e,t)=>new ke({shape:e,unknownKeys:"strip",catchall:Ee.create(),typeName:tt.ZodObject,...z(t)});class Se extends U{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map((async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map((e=>new _(e.ctx.common.issues)));return k(t,{code:b.invalid_union,unionErrors:r}),C}));{let e;const n=[];for(const a of r){const r={...t,common:{...t.common,issues:[]},parent:null},o=a._parseSync({data:t.data,path:t.path,parent:r});if("valid"===o.status)return o;"dirty"!==o.status||e||(e={result:o,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const a=n.map((e=>new _(e)));return k(t,{code:b.invalid_union,unionErrors:a}),C}}get options(){return this._def.options}}Se.create=(e,t)=>new Se({options:e,typeName:tt.ZodUnion,...z(t)});const Ce=e=>e instanceof Ne?Ce(e.schema):e instanceof Ue?Ce(e.innerType()):e instanceof Me?[e.value]:e instanceof Fe?e.options:e instanceof Ze?h.objectValues(e.enum):e instanceof Ge?Ce(e._def.innerType):e instanceof ve?[void 0]:e instanceof ye?[null]:e instanceof qe?[void 0,...Ce(e.unwrap())]:e instanceof Ve?[null,...Ce(e.unwrap())]:e instanceof Ke||e instanceof Je?Ce(e.unwrap()):e instanceof Be?Ce(e._def.innerType):[];class Ie extends U{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==v.object)return k(t,{code:b.invalid_type,expected:v.object,received:t.parsedType}),C;const r=this.discriminator,n=t.data[r],a=this.optionsMap.get(n);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(k(t,{code:b.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),C)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const n=new Map;for(const r of t){const t=Ce(r.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of t){if(n.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);n.set(a,r)}}return new Ie({typeName:tt.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...z(r)})}}function Te(e,t){const r=y(e),n=y(t);if(e===t)return{valid:!0,data:e};if(r===v.object&&n===v.object){const r=h.objectKeys(t),n=h.objectKeys(e).filter((e=>-1!==r.indexOf(e))),a={...e,...t};for(const r of n){const n=Te(e[r],t[r]);if(!n.valid)return{valid:!1};a[r]=n.data}return{valid:!0,data:a}}if(r===v.array&&n===v.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let n=0;n<e.length;n++){const a=Te(e[n],t[n]);if(!a.valid)return{valid:!1};r.push(a.data)}return{valid:!0,data:r}}return r===v.date&&n===v.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class Ae extends U{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if(A(e)||A(n))return C;const a=Te(e.value,n.value);return a.valid?((P(e)||P(n))&&t.dirty(),{status:t.value,value:a.data}):(k(r,{code:b.invalid_intersection_types}),C)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then((([e,t])=>n(e,t))):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Ae.create=(e,t,r)=>new Ae({left:e,right:t,typeName:tt.ZodIntersection,...z(r)});class Pe extends U{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==v.array)return k(r,{code:b.invalid_type,expected:v.array,received:r.parsedType}),C;if(r.data.length<this._def.items.length)return k(r,{code:b.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),C;!this._def.rest&&r.data.length>this._def.items.length&&(k(r,{code:b.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const n=[...r.data].map(((e,t)=>{const n=this._def.items[t]||this._def.rest;return n?n._parse(new F(r,e,r.path,t)):null})).filter((e=>!!e));return r.common.async?Promise.all(n).then((e=>S.mergeArray(t,e))):S.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new Pe({...this._def,rest:e})}}Pe.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Pe({items:e,typeName:tt.ZodTuple,rest:null,...z(t)})};class $e extends U{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==v.object)return k(r,{code:b.invalid_type,expected:v.object,received:r.parsedType}),C;const n=[],a=this._def.keyType,o=this._def.valueType;for(const e in r.data)n.push({key:a._parse(new F(r,e,r.path,e)),value:o._parse(new F(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?S.mergeObjectAsync(t,n):S.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new $e(t instanceof U?{keyType:e,valueType:t,typeName:tt.ZodRecord,...z(r)}:{keyType:de.create(),valueType:e,typeName:tt.ZodRecord,...z(t)})}}class je extends U{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==v.map)return k(r,{code:b.invalid_type,expected:v.map,received:r.parsedType}),C;const n=this._def.keyType,a=this._def.valueType,o=[...r.data.entries()].map((([e,t],o)=>({key:n._parse(new F(r,e,r.path,[o,"key"])),value:a._parse(new F(r,t,r.path,[o,"value"]))})));if(r.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const r of o){const n=await r.key,a=await r.value;if("aborted"===n.status||"aborted"===a.status)return C;"dirty"!==n.status&&"dirty"!==a.status||t.dirty(),e.set(n.value,a.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const r of o){const n=r.key,a=r.value;if("aborted"===n.status||"aborted"===a.status)return C;"dirty"!==n.status&&"dirty"!==a.status||t.dirty(),e.set(n.value,a.value)}return{status:t.value,value:e}}}}je.create=(e,t,r)=>new je({valueType:t,keyType:e,typeName:tt.ZodMap,...z(r)});class Re extends U{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==v.set)return k(r,{code:b.invalid_type,expected:v.set,received:r.parsedType}),C;const n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&(k(r,{code:b.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&(k(r,{code:b.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const a=this._def.valueType;function o(e){const r=new Set;for(const n of e){if("aborted"===n.status)return C;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}const i=[...r.data.values()].map(((e,t)=>a._parse(new F(r,e,r.path,t))));return r.common.async?Promise.all(i).then((e=>o(e))):o(i)}min(e,t){return new Re({...this._def,minSize:{value:e,message:N.toString(t)}})}max(e,t){return new Re({...this._def,maxSize:{value:e,message:N.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Re.create=(e,t)=>new Re({valueType:e,minSize:null,maxSize:null,typeName:tt.ZodSet,...z(t)});class Le extends U{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==v.function)return k(t,{code:b.invalid_type,expected:v.function,received:t.parsedType}),C;function r(e,r){return O({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,x(),E].filter((e=>!!e)),issueData:{code:b.invalid_arguments,argumentsError:r}})}function n(e,r){return O({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,x(),E].filter((e=>!!e)),issueData:{code:b.invalid_return_type,returnTypeError:r}})}const a={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof ze){const e=this;return T((async function(...t){const i=new _([]),s=await e._def.args.parseAsync(t,a).catch((e=>{throw i.addIssue(r(t,e)),i})),l=await Reflect.apply(o,this,s);return await e._def.returns._def.type.parseAsync(l,a).catch((e=>{throw i.addIssue(n(l,e)),i}))}))}{const e=this;return T((function(...t){const i=e._def.args.safeParse(t,a);if(!i.success)throw new _([r(t,i.error)]);const s=Reflect.apply(o,this,i.data),l=e._def.returns.safeParse(s,a);if(!l.success)throw new _([n(s,l.error)]);return l.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Le({...this._def,args:Pe.create(e).rest(_e.create())})}returns(e){return new Le({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Le({args:e||Pe.create([]).rest(_e.create()),returns:t||_e.create(),typeName:tt.ZodFunction,...z(r)})}}class Ne extends U{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ne.create=(e,t)=>new Ne({getter:e,typeName:tt.ZodLazy,...z(t)});class Me extends U{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return k(t,{received:t.data,code:b.invalid_literal,expected:this._def.value}),C}return{status:"valid",value:e.data}}get value(){return this._def.value}}function De(e,t){return new Fe({values:e,typeName:tt.ZodEnum,...z(t)})}Me.create=(e,t)=>new Me({value:e,typeName:tt.ZodLiteral,...z(t)});class Fe extends U{constructor(){super(...arguments),M.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return k(t,{expected:h.joinValues(r),received:t.parsedType,code:b.invalid_type}),C}if(R(this,M,"f")||L(this,M,new Set(this._def.values),"f"),!R(this,M,"f").has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return k(t,{received:t.data,code:b.invalid_enum_value,options:r}),C}return T(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Fe.create(e,{...this._def,...t})}exclude(e,t=this._def){return Fe.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}M=new WeakMap,Fe.create=De;class Ze extends U{constructor(){super(...arguments),D.set(this,void 0)}_parse(e){const t=h.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==v.string&&r.parsedType!==v.number){const e=h.objectValues(t);return k(r,{expected:h.joinValues(e),received:r.parsedType,code:b.invalid_type}),C}if(R(this,D,"f")||L(this,D,new Set(h.getValidEnumValues(this._def.values)),"f"),!R(this,D,"f").has(e.data)){const e=h.objectValues(t);return k(r,{received:r.data,code:b.invalid_enum_value,options:e}),C}return T(e.data)}get enum(){return this._def.values}}D=new WeakMap,Ze.create=(e,t)=>new Ze({values:e,typeName:tt.ZodNativeEnum,...z(t)});class ze extends U{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==v.promise&&!1===t.common.async)return k(t,{code:b.invalid_type,expected:v.promise,received:t.parsedType}),C;const r=t.parsedType===v.promise?t.data:Promise.resolve(t.data);return T(r.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}ze.create=(e,t)=>new ze({type:e,typeName:tt.ZodPromise,...z(t)});class Ue extends U{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===tt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,a={addIssue:e=>{k(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===n.type){const e=n.transform(r.data,a);if(r.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return C;const n=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===n.status?C:"dirty"===n.status||"dirty"===t.value?I(n.value):n}));{if("aborted"===t.value)return C;const n=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===n.status?C:"dirty"===n.status||"dirty"===t.value?I(n.value):n}}if("refinement"===n.type){const e=e=>{const t=n.refinement(e,a);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?C:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((r=>"aborted"===r.status?C:("dirty"===r.status&&t.dirty(),e(r.value).then((()=>({status:t.value,value:r.value}))))))}if("transform"===n.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!$(e))return e;const o=n.transform(e.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>$(e)?Promise.resolve(n.transform(e.value,a)).then((e=>({status:t.value,value:e}))):e))}h.assertNever(n)}}Ue.create=(e,t,r)=>new Ue({schema:e,typeName:tt.ZodEffects,effect:t,...z(r)}),Ue.createWithPreprocess=(e,t,r)=>new Ue({schema:t,effect:{type:"preprocess",transform:e},typeName:tt.ZodEffects,...z(r)});class qe extends U{_parse(e){return this._getType(e)===v.undefined?T(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}qe.create=(e,t)=>new qe({innerType:e,typeName:tt.ZodOptional,...z(t)});class Ve extends U{_parse(e){return this._getType(e)===v.null?T(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ve.create=(e,t)=>new Ve({innerType:e,typeName:tt.ZodNullable,...z(t)});class Ge extends U{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===v.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Ge.create=(e,t)=>new Ge({innerType:e,typeName:tt.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...z(t)});class Be extends U{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return j(n)?n.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new _(r.common.issues)},input:r.data})}))):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new _(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Be.create=(e,t)=>new Be({innerType:e,typeName:tt.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...z(t)});class He extends U{_parse(e){if(this._getType(e)!==v.nan){const t=this._getOrReturnCtx(e);return k(t,{code:b.invalid_type,expected:v.nan,received:t.parsedType}),C}return{status:"valid",value:e.data}}}He.create=e=>new He({typeName:tt.ZodNaN,...z(e)});const We=Symbol("zod_brand");class Ke extends U{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Xe extends U{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?C:"dirty"===e.status?(t.dirty(),I(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?C:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new Xe({in:e,out:t,typeName:tt.ZodPipeline})}}class Je extends U{_parse(e){const t=this._def.innerType._parse(e),r=e=>($(e)&&(e.value=Object.freeze(e.value)),e);return j(t)?t.then((e=>r(e))):r(t)}unwrap(){return this._def.innerType}}function Ye(e,t){const r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function Qe(e,t={},r){return e?be.create().superRefine(((n,a)=>{var o,i;const s=e(n);if(s instanceof Promise)return s.then((e=>{var o,i;if(!e){const e=Ye(t,n),s=null===(i=null!==(o=e.fatal)&&void 0!==o?o:r)||void 0===i||i;a.addIssue({code:"custom",...e,fatal:s})}}));if(!s){const e=Ye(t,n),s=null===(i=null!==(o=e.fatal)&&void 0!==o?o:r)||void 0===i||i;a.addIssue({code:"custom",...e,fatal:s})}})):be.create()}Je.create=(e,t)=>new Je({innerType:e,typeName:tt.ZodReadonly,...z(t)});const et={object:ke.lazycreate};var tt;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(tt||(tt={}));const rt=de.create,nt=pe.create,at=He.create,ot=he.create,it=me.create,st=fe.create,lt=ge.create,ct=ve.create,dt=ye.create,ut=be.create,pt=_e.create,ht=Ee.create,mt=we.create,ft=xe.create,gt=ke.create,vt=ke.strictCreate,yt=Se.create,bt=Ie.create,_t=Ae.create,Et=Pe.create,wt=$e.create,xt=je.create,Ot=Re.create,kt=Le.create,St=Ne.create,Ct=Me.create,It=Fe.create,Tt=Ze.create,At=ze.create,Pt=Ue.create,$t=qe.create,jt=Ve.create,Rt=Ue.createWithPreprocess,Lt=Xe.create,Nt={string:e=>de.create({...e,coerce:!0}),number:e=>pe.create({...e,coerce:!0}),boolean:e=>me.create({...e,coerce:!0}),bigint:e=>he.create({...e,coerce:!0}),date:e=>fe.create({...e,coerce:!0})},Mt=C;var Dt=Object.freeze({__proto__:null,defaultErrorMap:E,setErrorMap:function(e){w=e},getErrorMap:x,makeIssue:O,EMPTY_PATH:[],addIssueToContext:k,ParseStatus:S,INVALID:C,DIRTY:I,OK:T,isAborted:A,isDirty:P,isValid:$,isAsync:j,get util(){return h},get objectUtil(){return m},ZodParsedType:v,getParsedType:y,ZodType:U,datetimeRegex:se,ZodString:de,ZodNumber:pe,ZodBigInt:he,ZodBoolean:me,ZodDate:fe,ZodSymbol:ge,ZodUndefined:ve,ZodNull:ye,ZodAny:be,ZodUnknown:_e,ZodNever:Ee,ZodVoid:we,ZodArray:xe,ZodObject:ke,ZodUnion:Se,ZodDiscriminatedUnion:Ie,ZodIntersection:Ae,ZodTuple:Pe,ZodRecord:$e,ZodMap:je,ZodSet:Re,ZodFunction:Le,ZodLazy:Ne,ZodLiteral:Me,ZodEnum:Fe,ZodNativeEnum:Ze,ZodPromise:ze,ZodEffects:Ue,ZodTransformer:Ue,ZodOptional:qe,ZodNullable:Ve,ZodDefault:Ge,ZodCatch:Be,ZodNaN:He,BRAND:We,ZodBranded:Ke,ZodPipeline:Xe,ZodReadonly:Je,custom:Qe,Schema:U,ZodSchema:U,late:et,get ZodFirstPartyTypeKind(){return tt},coerce:Nt,any:ut,array:ft,bigint:ot,boolean:it,date:st,discriminatedUnion:bt,effect:Pt,enum:It,function:kt,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>Qe((t=>t instanceof e),t),intersection:_t,lazy:St,literal:Ct,map:xt,nan:at,nativeEnum:Tt,never:ht,null:dt,nullable:jt,number:nt,object:gt,oboolean:()=>it().optional(),onumber:()=>nt().optional(),optional:$t,ostring:()=>rt().optional(),pipeline:Lt,preprocess:Rt,promise:At,record:wt,set:Ot,strictObject:vt,string:rt,symbol:lt,transformer:Pt,tuple:Et,undefined:ct,union:yt,unknown:pt,void:mt,NEVER:Mt,ZodIssueCode:b,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:_});const Ft="2025-03-26",Zt=[Ft,"2024-11-05","2024-10-07"],zt="2.0",Ut=Dt.union([Dt.string(),Dt.number().int()]),qt=Dt.string(),Vt=Dt.object({progressToken:Dt.optional(Ut)}).passthrough(),Gt=Dt.object({_meta:Dt.optional(Vt)}).passthrough(),Bt=Dt.object({method:Dt.string(),params:Dt.optional(Gt)}),Ht=Dt.object({_meta:Dt.optional(Dt.object({}).passthrough())}).passthrough(),Wt=Dt.object({method:Dt.string(),params:Dt.optional(Ht)}),Kt=Dt.object({_meta:Dt.optional(Dt.object({}).passthrough())}).passthrough(),Xt=Dt.union([Dt.string(),Dt.number().int()]),Jt=Dt.object({jsonrpc:Dt.literal(zt),id:Xt}).merge(Bt).strict(),Yt=e=>Jt.safeParse(e).success,Qt=Dt.object({jsonrpc:Dt.literal(zt)}).merge(Wt).strict(),er=Dt.object({jsonrpc:Dt.literal(zt),id:Xt,result:Kt}).strict(),tr=e=>er.safeParse(e).success;var rr;!function(e){e[e.ConnectionClosed=-32e3]="ConnectionClosed",e[e.RequestTimeout=-32001]="RequestTimeout",e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError"}(rr||(rr={}));const nr=Dt.object({jsonrpc:Dt.literal(zt),id:Xt,error:Dt.object({code:Dt.number().int(),message:Dt.string(),data:Dt.optional(Dt.unknown())})}).strict(),ar=Dt.union([Jt,Qt,er,nr]),or=Kt.strict(),ir=Wt.extend({method:Dt.literal("notifications/cancelled"),params:Ht.extend({requestId:Xt,reason:Dt.string().optional()})}),sr=Dt.object({name:Dt.string(),version:Dt.string()}).passthrough(),lr=Dt.object({experimental:Dt.optional(Dt.object({}).passthrough()),sampling:Dt.optional(Dt.object({}).passthrough()),roots:Dt.optional(Dt.object({listChanged:Dt.optional(Dt.boolean())}).passthrough())}).passthrough(),cr=Bt.extend({method:Dt.literal("initialize"),params:Gt.extend({protocolVersion:Dt.string(),capabilities:lr,clientInfo:sr})}),dr=Dt.object({experimental:Dt.optional(Dt.object({}).passthrough()),logging:Dt.optional(Dt.object({}).passthrough()),completions:Dt.optional(Dt.object({}).passthrough()),prompts:Dt.optional(Dt.object({listChanged:Dt.optional(Dt.boolean())}).passthrough()),resources:Dt.optional(Dt.object({subscribe:Dt.optional(Dt.boolean()),listChanged:Dt.optional(Dt.boolean())}).passthrough()),tools:Dt.optional(Dt.object({listChanged:Dt.optional(Dt.boolean())}).passthrough())}).passthrough(),ur=Kt.extend({protocolVersion:Dt.string(),capabilities:dr,serverInfo:sr,instructions:Dt.optional(Dt.string())}),pr=Wt.extend({method:Dt.literal("notifications/initialized")}),hr=Bt.extend({method:Dt.literal("ping")}),mr=Dt.object({progress:Dt.number(),total:Dt.optional(Dt.number())}).passthrough(),fr=Wt.extend({method:Dt.literal("notifications/progress"),params:Ht.merge(mr).extend({progressToken:Ut})}),gr=Bt.extend({params:Gt.extend({cursor:Dt.optional(qt)}).optional()}),vr=Kt.extend({nextCursor:Dt.optional(qt)}),yr=Dt.object({uri:Dt.string(),mimeType:Dt.optional(Dt.string())}).passthrough(),br=yr.extend({text:Dt.string()}),_r=yr.extend({blob:Dt.string().base64()}),Er=Dt.object({uri:Dt.string(),name:Dt.string(),description:Dt.optional(Dt.string()),mimeType:Dt.optional(Dt.string())}).passthrough(),wr=Dt.object({uriTemplate:Dt.string(),name:Dt.string(),description:Dt.optional(Dt.string()),mimeType:Dt.optional(Dt.string())}).passthrough(),xr=gr.extend({method:Dt.literal("resources/list")}),Or=vr.extend({resources:Dt.array(Er)}),kr=gr.extend({method:Dt.literal("resources/templates/list")}),Sr=vr.extend({resourceTemplates:Dt.array(wr)}),Cr=Bt.extend({method:Dt.literal("resources/read"),params:Gt.extend({uri:Dt.string()})}),Ir=Kt.extend({contents:Dt.array(Dt.union([br,_r]))}),Tr=Wt.extend({method:Dt.literal("notifications/resources/list_changed")}),Ar=Bt.extend({method:Dt.literal("resources/subscribe"),params:Gt.extend({uri:Dt.string()})}),Pr=Bt.extend({method:Dt.literal("resources/unsubscribe"),params:Gt.extend({uri:Dt.string()})}),$r=Wt.extend({method:Dt.literal("notifications/resources/updated"),params:Ht.extend({uri:Dt.string()})}),jr=Dt.object({name:Dt.string(),description:Dt.optional(Dt.string()),required:Dt.optional(Dt.boolean())}).passthrough(),Rr=Dt.object({name:Dt.string(),description:Dt.optional(Dt.string()),arguments:Dt.optional(Dt.array(jr))}).passthrough(),Lr=gr.extend({method:Dt.literal("prompts/list")}),Nr=vr.extend({prompts:Dt.array(Rr)}),Mr=Bt.extend({method:Dt.literal("prompts/get"),params:Gt.extend({name:Dt.string(),arguments:Dt.optional(Dt.record(Dt.string()))})}),Dr=Dt.object({type:Dt.literal("text"),text:Dt.string()}).passthrough(),Fr=Dt.object({type:Dt.literal("image"),data:Dt.string().base64(),mimeType:Dt.string()}).passthrough(),Zr=Dt.object({type:Dt.literal("audio"),data:Dt.string().base64(),mimeType:Dt.string()}).passthrough(),zr=Dt.object({type:Dt.literal("resource"),resource:Dt.union([br,_r])}).passthrough(),Ur=Dt.object({role:Dt.enum(["user","assistant"]),content:Dt.union([Dr,Fr,Zr,zr])}).passthrough(),qr=Kt.extend({description:Dt.optional(Dt.string()),messages:Dt.array(Ur)}),Vr=Wt.extend({method:Dt.literal("notifications/prompts/list_changed")}),Gr=Dt.object({title:Dt.optional(Dt.string()),readOnlyHint:Dt.optional(Dt.boolean()),destructiveHint:Dt.optional(Dt.boolean()),idempotentHint:Dt.optional(Dt.boolean()),openWorldHint:Dt.optional(Dt.boolean())}).passthrough(),Br=Dt.object({name:Dt.string(),description:Dt.optional(Dt.string()),inputSchema:Dt.object({type:Dt.literal("object"),properties:Dt.optional(Dt.object({}).passthrough())}).passthrough(),annotations:Dt.optional(Gr)}).passthrough(),Hr=gr.extend({method:Dt.literal("tools/list")}),Wr=vr.extend({tools:Dt.array(Br)}),Kr=Kt.extend({content:Dt.array(Dt.union([Dr,Fr,Zr,zr])),isError:Dt.boolean().default(!1).optional()}),Xr=(Kr.or(Kt.extend({toolResult:Dt.unknown()})),Bt.extend({method:Dt.literal("tools/call"),params:Gt.extend({name:Dt.string(),arguments:Dt.optional(Dt.record(Dt.unknown()))})})),Jr=Wt.extend({method:Dt.literal("notifications/tools/list_changed")}),Yr=Dt.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),Qr=Bt.extend({method:Dt.literal("logging/setLevel"),params:Gt.extend({level:Yr})}),en=Wt.extend({method:Dt.literal("notifications/message"),params:Ht.extend({level:Yr,logger:Dt.optional(Dt.string()),data:Dt.unknown()})}),tn=Dt.object({name:Dt.string().optional()}).passthrough(),rn=Dt.object({hints:Dt.optional(Dt.array(tn)),costPriority:Dt.optional(Dt.number().min(0).max(1)),speedPriority:Dt.optional(Dt.number().min(0).max(1)),intelligencePriority:Dt.optional(Dt.number().min(0).max(1))}).passthrough(),nn=Dt.object({role:Dt.enum(["user","assistant"]),content:Dt.union([Dr,Fr,Zr])}).passthrough(),an=Bt.extend({method:Dt.literal("sampling/createMessage"),params:Gt.extend({messages:Dt.array(nn),systemPrompt:Dt.optional(Dt.string()),includeContext:Dt.optional(Dt.enum(["none","thisServer","allServers"])),temperature:Dt.optional(Dt.number()),maxTokens:Dt.number().int(),stopSequences:Dt.optional(Dt.array(Dt.string())),metadata:Dt.optional(Dt.object({}).passthrough()),modelPreferences:Dt.optional(rn)})}),on=Kt.extend({model:Dt.string(),stopReason:Dt.optional(Dt.enum(["endTurn","stopSequence","maxTokens"]).or(Dt.string())),role:Dt.enum(["user","assistant"]),content:Dt.discriminatedUnion("type",[Dr,Fr,Zr])}),sn=Dt.object({type:Dt.literal("ref/resource"),uri:Dt.string()}).passthrough(),ln=Dt.object({type:Dt.literal("ref/prompt"),name:Dt.string()}).passthrough(),cn=Bt.extend({method:Dt.literal("completion/complete"),params:Gt.extend({ref:Dt.union([ln,sn]),argument:Dt.object({name:Dt.string(),value:Dt.string()}).passthrough()})}),dn=Kt.extend({completion:Dt.object({values:Dt.array(Dt.string()).max(100),total:Dt.optional(Dt.number().int()),hasMore:Dt.optional(Dt.boolean())}).passthrough()}),un=Dt.object({uri:Dt.string().startsWith("file://"),name:Dt.optional(Dt.string())}).passthrough(),pn=Bt.extend({method:Dt.literal("roots/list")}),hn=Kt.extend({roots:Dt.array(un)}),mn=Wt.extend({method:Dt.literal("notifications/roots/list_changed")});Dt.union([hr,cr,cn,Qr,Mr,Lr,xr,kr,Cr,Ar,Pr,Xr,Hr]),Dt.union([ir,fr,pr,mn]),Dt.union([or,on,hn]),Dt.union([hr,an,pn]),Dt.union([ir,fr,en,$r,Tr,Jr,Vr]),Dt.union([or,ur,dn,qr,Nr,Or,Sr,Ir,Kr,Wr]);class fn extends Error{constructor(e,t,r){super(`MCP error ${e}: ${t}`),this.code=e,this.data=r,this.name="McpError"}}class gn{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this.setNotificationHandler(ir,(e=>{const t=this._requestHandlerAbortControllers.get(e.params.requestId);null==t||t.abort(e.params.reason)})),this.setNotificationHandler(fr,(e=>{this._onprogress(e)})),this.setRequestHandler(hr,(e=>({})))}_setupTimeout(e,t,r,n,a=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(n,t),startTime:Date.now(),timeout:t,maxTotalTimeout:r,resetTimeoutOnProgress:a,onTimeout:n})}_resetTimeout(e){const t=this._timeoutInfo.get(e);if(!t)return!1;const r=Date.now()-t.startTime;if(t.maxTotalTimeout&&r>=t.maxTotalTimeout)throw this._timeoutInfo.delete(e),new fn(rr.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:t.maxTotalTimeout,totalElapsed:r});return clearTimeout(t.timeoutId),t.timeoutId=setTimeout(t.onTimeout,t.timeout),!0}_cleanupTimeout(e){const t=this._timeoutInfo.get(e);t&&(clearTimeout(t.timeoutId),this._timeoutInfo.delete(e))}async connect(e){this._transport=e,this._transport.onclose=()=>{this._onclose()},this._transport.onerror=e=>{this._onerror(e)},this._transport.onmessage=(e,t)=>{var r;tr(e)||(r=e,nr.safeParse(r).success)?this._onresponse(e):Yt(e)?this._onrequest(e,t):(e=>Qt.safeParse(e).success)(e)?this._onnotification(e):this._onerror(new Error(`Unknown message type: ${JSON.stringify(e)}`))},await this._transport.start()}_onclose(){var e;const t=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._transport=void 0,null===(e=this.onclose)||void 0===e||e.call(this);const r=new fn(rr.ConnectionClosed,"Connection closed");for(const e of t.values())e(r)}_onerror(e){var t;null===(t=this.onerror)||void 0===t||t.call(this,e)}_onnotification(e){var t;const r=null!==(t=this._notificationHandlers.get(e.method))&&void 0!==t?t:this.fallbackNotificationHandler;void 0!==r&&Promise.resolve().then((()=>r(e))).catch((e=>this._onerror(new Error(`Uncaught error in notification handler: ${e}`))))}_onrequest(e,t){var r,n,a,o;const i=null!==(r=this._requestHandlers.get(e.method))&&void 0!==r?r:this.fallbackRequestHandler;if(void 0===i)return void(null===(n=this._transport)||void 0===n||n.send({jsonrpc:"2.0",id:e.id,error:{code:rr.MethodNotFound,message:"Method not found"}}).catch((e=>this._onerror(new Error(`Failed to send an error response: ${e}`)))));const s=new AbortController;this._requestHandlerAbortControllers.set(e.id,s);const l={signal:s.signal,sessionId:null===(a=this._transport)||void 0===a?void 0:a.sessionId,_meta:null===(o=e.params)||void 0===o?void 0:o._meta,sendNotification:t=>this.notification(t,{relatedRequestId:e.id}),sendRequest:(t,r,n)=>this.request(t,r,{...n,relatedRequestId:e.id}),authInfo:null==t?void 0:t.authInfo,requestId:e.id};Promise.resolve().then((()=>i(e,l))).then((t=>{var r;if(!s.signal.aborted)return null===(r=this._transport)||void 0===r?void 0:r.send({result:t,jsonrpc:"2.0",id:e.id})}),(t=>{var r,n;if(!s.signal.aborted)return null===(r=this._transport)||void 0===r?void 0:r.send({jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(t.code)?t.code:rr.InternalError,message:null!==(n=t.message)&&void 0!==n?n:"Internal error"}})})).catch((e=>this._onerror(new Error(`Failed to send response: ${e}`)))).finally((()=>{this._requestHandlerAbortControllers.delete(e.id)}))}_onprogress(e){const{progressToken:t,...r}=e.params,n=Number(t),a=this._progressHandlers.get(n);if(!a)return void this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));const o=this._responseHandlers.get(n),i=this._timeoutInfo.get(n);if(i&&o&&i.resetTimeoutOnProgress)try{this._resetTimeout(n)}catch(e){return void o(e)}a(r)}_onresponse(e){const t=Number(e.id),r=this._responseHandlers.get(t);void 0!==r?(this._responseHandlers.delete(t),this._progressHandlers.delete(t),this._cleanupTimeout(t),tr(e)?r(e):r(new fn(e.error.code,e.error.message,e.error.data))):this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`))}get transport(){return this._transport}async close(){var e;await(null===(e=this._transport)||void 0===e?void 0:e.close())}request(e,t,r){const{relatedRequestId:n,resumptionToken:a,onresumptiontoken:o}=null!=r?r:{};return new Promise(((i,s)=>{var l,c,d,u,p;if(!this._transport)return void s(new Error("Not connected"));!0===(null===(l=this._options)||void 0===l?void 0:l.enforceStrictCapabilities)&&this.assertCapabilityForMethod(e.method),null===(c=null==r?void 0:r.signal)||void 0===c||c.throwIfAborted();const h=this._requestMessageId++,m={...e,jsonrpc:"2.0",id:h};(null==r?void 0:r.onprogress)&&(this._progressHandlers.set(h,r.onprogress),m.params={...e.params,_meta:{progressToken:h}});const f=e=>{var t;this._responseHandlers.delete(h),this._progressHandlers.delete(h),this._cleanupTimeout(h),null===(t=this._transport)||void 0===t||t.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:h,reason:String(e)}},{relatedRequestId:n,resumptionToken:a,onresumptiontoken:o}).catch((e=>this._onerror(new Error(`Failed to send cancellation: ${e}`)))),s(e)};this._responseHandlers.set(h,(e=>{var n;if(!(null===(n=null==r?void 0:r.signal)||void 0===n?void 0:n.aborted)){if(e instanceof Error)return s(e);try{const r=t.parse(e.result);i(r)}catch(e){s(e)}}})),null===(d=null==r?void 0:r.signal)||void 0===d||d.addEventListener("abort",(()=>{var e;f(null===(e=null==r?void 0:r.signal)||void 0===e?void 0:e.reason)}));const g=null!==(u=null==r?void 0:r.timeout)&&void 0!==u?u:6e4;this._setupTimeout(h,g,null==r?void 0:r.maxTotalTimeout,(()=>f(new fn(rr.RequestTimeout,"Request timed out",{timeout:g}))),null!==(p=null==r?void 0:r.resetTimeoutOnProgress)&&void 0!==p&&p),this._transport.send(m,{relatedRequestId:n,resumptionToken:a,onresumptiontoken:o}).catch((e=>{this._cleanupTimeout(h),s(e)}))}))}async notification(e,t){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);const r={...e,jsonrpc:"2.0"};await this._transport.send(r,t)}setRequestHandler(e,t){const r=e.shape.method.value;this.assertRequestHandlerCapability(r),this._requestHandlers.set(r,((r,n)=>Promise.resolve(t(e.parse(r),n))))}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,t){this._notificationHandlers.set(e.shape.method.value,(r=>Promise.resolve(t(e.parse(r)))))}removeNotificationHandler(e){this._notificationHandlers.delete(e)}}class vn extends gn{constructor(e,t){var r;super(t),this._clientInfo=e,this._capabilities=null!==(r=null==t?void 0:t.capabilities)&&void 0!==r?r:{}}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");var t,r;this._capabilities=(t=this._capabilities,r=e,Object.entries(r).reduce(((e,[t,r])=>(e[t]=r&&"object"==typeof r&&e[t]?{...e[t],...r}:r,e)),{...t}))}assertCapability(e,t){var r;if(!(null===(r=this._serverCapabilities)||void 0===r?void 0:r[e]))throw new Error(`Server does not support ${e} (required for ${t})`)}async connect(e,t){if(await super.connect(e),void 0===e.sessionId)try{const e=await this.request({method:"initialize",params:{protocolVersion:Ft,capabilities:this._capabilities,clientInfo:this._clientInfo}},ur,t);if(void 0===e)throw new Error(`Server sent invalid initialize result: ${e}`);if(!Zt.includes(e.protocolVersion))throw new Error(`Server's protocol version is not supported: ${e.protocolVersion}`);this._serverCapabilities=e.capabilities,this._serverVersion=e.serverInfo,this._instructions=e.instructions,await this.notification({method:"notifications/initialized"})}catch(e){throw this.close(),e}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(e){var t,r,n,a,o;switch(e){case"logging/setLevel":if(!(null===(t=this._serverCapabilities)||void 0===t?void 0:t.logging))throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!(null===(r=this._serverCapabilities)||void 0===r?void 0:r.prompts))throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!(null===(n=this._serverCapabilities)||void 0===n?void 0:n.resources))throw new Error(`Server does not support resources (required for ${e})`);if("resources/subscribe"===e&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${e})`);break;case"tools/call":case"tools/list":if(!(null===(a=this._serverCapabilities)||void 0===a?void 0:a.tools))throw new Error(`Server does not support tools (required for ${e})`);break;case"completion/complete":if(!(null===(o=this._serverCapabilities)||void 0===o?void 0:o.completions))throw new Error(`Server does not support completions (required for ${e})`)}}assertNotificationCapability(e){var t;if("notifications/roots/list_changed"===e&&!(null===(t=this._capabilities.roots)||void 0===t?void 0:t.listChanged))throw new Error(`Client does not support roots list changed notifications (required for ${e})`)}assertRequestHandlerCapability(e){switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${e})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${e})`)}}async ping(e){return this.request({method:"ping"},or,e)}async complete(e,t){return this.request({method:"completion/complete",params:e},dn,t)}async setLoggingLevel(e,t){return this.request({method:"logging/setLevel",params:{level:e}},or,t)}async getPrompt(e,t){return this.request({method:"prompts/get",params:e},qr,t)}async listPrompts(e,t){return this.request({method:"prompts/list",params:e},Nr,t)}async listResources(e,t){return this.request({method:"resources/list",params:e},Or,t)}async listResourceTemplates(e,t){return this.request({method:"resources/templates/list",params:e},Sr,t)}async readResource(e,t){return this.request({method:"resources/read",params:e},Ir,t)}async subscribeResource(e,t){return this.request({method:"resources/subscribe",params:e},or,t)}async unsubscribeResource(e,t){return this.request({method:"resources/unsubscribe",params:e},or,t)}async callTool(e,t=Kr,r){return this.request({method:"tools/call",params:e},t,r)}async listTools(e,t){return this.request({method:"tools/list",params:e},Wr,t)}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}}let yn;async function bn(e){const t=await(await yn).subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function _n(e){if(e||(e=43),e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;const t=await async function(e){return await async function(e){let t="";const r=await async function(e){return(await yn).getRandomValues(new Uint8Array(e))}(e);for(let n=0;n<e;n++)t+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~"[r[n]%66];return t}(e)}(e);return{code_verifier:t,code_challenge:await bn(t)}}yn=globalThis.crypto;const En=Dt.object({issuer:Dt.string(),authorization_endpoint:Dt.string(),token_endpoint:Dt.string(),registration_endpoint:Dt.string().optional(),scopes_supported:Dt.array(Dt.string()).optional(),response_types_supported:Dt.array(Dt.string()),response_modes_supported:Dt.array(Dt.string()).optional(),grant_types_supported:Dt.array(Dt.string()).optional(),token_endpoint_auth_methods_supported:Dt.array(Dt.string()).optional(),token_endpoint_auth_signing_alg_values_supported:Dt.array(Dt.string()).optional(),service_documentation:Dt.string().optional(),revocation_endpoint:Dt.string().optional(),revocation_endpoint_auth_methods_supported:Dt.array(Dt.string()).optional(),revocation_endpoint_auth_signing_alg_values_supported:Dt.array(Dt.string()).optional(),introspection_endpoint:Dt.string().optional(),introspection_endpoint_auth_methods_supported:Dt.array(Dt.string()).optional(),introspection_endpoint_auth_signing_alg_values_supported:Dt.array(Dt.string()).optional(),code_challenge_methods_supported:Dt.array(Dt.string()).optional()}).passthrough(),wn=Dt.object({access_token:Dt.string(),token_type:Dt.string(),expires_in:Dt.number().optional(),scope:Dt.string().optional(),refresh_token:Dt.string().optional()}).strip(),xn=(Dt.object({error:Dt.string(),error_description:Dt.string().optional(),error_uri:Dt.string().optional()}),Dt.object({redirect_uris:Dt.array(Dt.string()).refine((e=>e.every((e=>URL.canParse(e)))),{message:"redirect_uris must contain valid URLs"}),token_endpoint_auth_method:Dt.string().optional(),grant_types:Dt.array(Dt.string()).optional(),response_types:Dt.array(Dt.string()).optional(),client_name:Dt.string().optional(),client_uri:Dt.string().optional(),logo_uri:Dt.string().optional(),scope:Dt.string().optional(),contacts:Dt.array(Dt.string()).optional(),tos_uri:Dt.string().optional(),policy_uri:Dt.string().optional(),jwks_uri:Dt.string().optional(),jwks:Dt.any().optional(),software_id:Dt.string().optional(),software_version:Dt.string().optional()}).strip()),On=Dt.object({client_id:Dt.string(),client_secret:Dt.string().optional(),client_id_issued_at:Dt.number().optional(),client_secret_expires_at:Dt.number().optional()}).strip(),kn=xn.merge(On);Dt.object({error:Dt.string(),error_description:Dt.string().optional()}).strip(),Dt.object({token:Dt.string(),token_type_hint:Dt.string().optional()}).strip();class Sn extends Error{constructor(e){super(null!=e?e:"Unauthorized")}}async function Cn(e,{serverUrl:t,authorizationCode:r,scope:n}){const a=await async function(e,t){const r=new URL("/.well-known/oauth-authorization-server",e);let n;try{n=await fetch(r,{headers:{"MCP-Protocol-Version":(void 0,Ft)}})}catch(e){if(!(e instanceof TypeError))throw e;n=await fetch(r)}if(404!==n.status){if(!n.ok)throw new Error(`HTTP ${n.status} trying to load well-known OAuth metadata`);return En.parse(await n.json())}}(t);let o=await Promise.resolve(e.clientInformation());if(!o){if(void 0!==r)throw new Error("Existing OAuth client information is required when exchanging an authorization code");if(!e.saveClientInformation)throw new Error("OAuth client information must be saveable for dynamic registration");const n=await async function(e,{metadata:t,clientMetadata:r}){let n;if(t){if(!t.registration_endpoint)throw new Error("Incompatible auth server: does not support dynamic client registration");n=new URL(t.registration_endpoint)}else n=new URL("/register",e);const a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok)throw new Error(`Dynamic client registration failed: HTTP ${a.status}`);return kn.parse(await a.json())}(t,{metadata:a,clientMetadata:e.clientMetadata});await e.saveClientInformation(n),o=n}if(void 0!==r){const n=await e.codeVerifier(),i=await async function(e,{metadata:t,clientInformation:r,authorizationCode:n,codeVerifier:a,redirectUri:o}){const i="authorization_code";let s;if(t){if(s=new URL(t.token_endpoint),t.grant_types_supported&&!t.grant_types_supported.includes(i))throw new Error(`Incompatible auth server: does not support grant type ${i}`)}else s=new URL("/token",e);const l=new URLSearchParams({grant_type:i,client_id:r.client_id,code:n,code_verifier:a,redirect_uri:String(o)});r.client_secret&&l.set("client_secret",r.client_secret);const c=await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:l});if(!c.ok)throw new Error(`Token exchange failed: HTTP ${c.status}`);return wn.parse(await c.json())}(t,{metadata:a,clientInformation:o,authorizationCode:r,codeVerifier:n,redirectUri:e.redirectUrl});return await e.saveTokens(i),"AUTHORIZED"}const i=await e.tokens();if(null==i?void 0:i.refresh_token)try{const r=await async function(e,{metadata:t,clientInformation:r,refreshToken:n}){const a="refresh_token";let o;if(t){if(o=new URL(t.token_endpoint),t.grant_types_supported&&!t.grant_types_supported.includes(a))throw new Error(`Incompatible auth server: does not support grant type ${a}`)}else o=new URL("/token",e);const i=new URLSearchParams({grant_type:a,client_id:r.client_id,refresh_token:n});r.client_secret&&i.set("client_secret",r.client_secret);const s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i});if(!s.ok)throw new Error(`Token refresh failed: HTTP ${s.status}`);return wn.parse(await s.json())}(t,{metadata:a,clientInformation:o,refreshToken:i.refresh_token});return await e.saveTokens(r),"AUTHORIZED"}catch(e){console.error("Could not refresh OAuth tokens:",e)}const{authorizationUrl:s,codeVerifier:l}=await async function(e,{metadata:t,clientInformation:r,redirectUrl:n,scope:a}){const o="code",i="S256";let s;if(t){if(s=new URL(t.authorization_endpoint),!t.response_types_supported.includes(o))throw new Error(`Incompatible auth server: does not support response type ${o}`);if(!t.code_challenge_methods_supported||!t.code_challenge_methods_supported.includes(i))throw new Error(`Incompatible auth server: does not support code challenge method ${i}`)}else s=new URL("/authorize",e);const l=await _n(),c=l.code_verifier,d=l.code_challenge;return s.searchParams.set("response_type",o),s.searchParams.set("client_id",r.client_id),s.searchParams.set("code_challenge",d),s.searchParams.set("code_challenge_method",i),s.searchParams.set("redirect_uri",String(n)),a&&s.searchParams.set("scope",a),{authorizationUrl:s,codeVerifier:c}}(t,{metadata:a,clientInformation:o,redirectUrl:e.redirectUrl,scope:n||e.clientMetadata.scope});return await e.saveCodeVerifier(l),await e.redirectToAuthorization(s),"REDIRECT"}var In=Object.defineProperty,Tn=(e,t,r)=>((e,t,r)=>t in e?In(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class An extends Error{constructor(e,t){super(e),Tn(this,"type"),Tn(this,"field"),Tn(this,"value"),Tn(this,"line"),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function Pn(e){}class $n extends TransformStream{constructor({onError:e,onRetry:t,onComment:r}={}){let n;super({start(a){n=function(e){const{onEvent:t=Pn,onError:r=Pn,onRetry:n=Pn,onComment:a}=e;let o,i="",s=!0,l="",c="";function d(e){if(""===e)return l.length>0&&t({id:o,event:c||void 0,data:l.endsWith("\n")?l.slice(0,-1):l}),o=void 0,l="",void(c="");if(e.startsWith(":"))return void(a&&a(e.slice(e.startsWith(": ")?2:1)));const r=e.indexOf(":");if(-1===r)u(e,"",e);else{const t=e.slice(0,r),n=" "===e[r+1]?2:1;u(t,e.slice(r+n),e)}}function u(e,t,a){switch(e){case"event":c=t;break;case"data":l=`${l}${t}\n`;break;case"id":o=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?n(parseInt(t,10)):r(new An(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:a}));break;default:r(new An(`Unknown field "${e.length>20?`${e.slice(0,20)}`:e}"`,{type:"unknown-field",field:e,value:t,line:a}))}}return{feed:function(e){const t=s?e.replace(/^\xEF\xBB\xBF/,""):e,[r,n]=function(e){const t=[];let r="";const n=e.length;for(let a=0;a<n;a++){const n=e[a];"\r"===n&&"\n"===e[a+1]?(t.push(r),r="",a++):"\r"===n||"\n"===n?(t.push(r),r=""):r+=n}return[t,r]}(`${i}${t}`);for(const e of r)d(e);i=n,s=!1},reset:function(e={}){i&&e.consume&&d(i),o=void 0,l="",c="",i=""}}}({onEvent:e=>{a.enqueue(e)},onError(t){"terminate"===e?a.error(t):"function"==typeof e&&e(t)},onRetry:t,onComment:r})},transform(e){n.feed(e)}})}}const jn={initialReconnectionDelay:1e3,maxReconnectionDelay:3e4,reconnectionDelayGrowFactor:1.5,maxRetries:2};class Rn extends Error{constructor(e,t){super(`Streamable HTTP error: ${t}`),this.code=e}}class Ln{constructor(e,t){var r;this._url=e,this._requestInit=null==t?void 0:t.requestInit,this._authProvider=null==t?void 0:t.authProvider,this._sessionId=null==t?void 0:t.sessionId,this._reconnectionOptions=null!==(r=null==t?void 0:t.reconnectionOptions)&&void 0!==r?r:jn}async _authThenStart(){var e;if(!this._authProvider)throw new Sn("No auth provider");let t;try{t=await Cn(this._authProvider,{serverUrl:this._url})}catch(t){throw null===(e=this.onerror)||void 0===e||e.call(this,t),t}if("AUTHORIZED"!==t)throw new Sn;return await this._startOrAuthSse({resumptionToken:void 0})}async _commonHeaders(){var e;const t={};if(this._authProvider){const e=await this._authProvider.tokens();e&&(t.Authorization=`Bearer ${e.access_token}`)}return this._sessionId&&(t["mcp-session-id"]=this._sessionId),new Headers({...t,...null===(e=this._requestInit)||void 0===e?void 0:e.headers})}async _startOrAuthSse(e){var t,r;const{resumptionToken:n}=e;try{const r=await this._commonHeaders();r.set("Accept","text/event-stream"),n&&r.set("last-event-id",n);const a=await fetch(this._url,{method:"GET",headers:r,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal});if(!a.ok){if(401===a.status&&this._authProvider)return await this._authThenStart();if(405===a.status)return;throw new Rn(a.status,`Failed to open SSE stream: ${a.statusText}`)}this._handleSseStream(a.body,e)}catch(e){throw null===(r=this.onerror)||void 0===r||r.call(this,e),e}}_getNextReconnectionDelay(e){const t=this._reconnectionOptions.initialReconnectionDelay,r=this._reconnectionOptions.reconnectionDelayGrowFactor,n=this._reconnectionOptions.maxReconnectionDelay;return Math.min(t*Math.pow(r,e),n)}_scheduleReconnection(e,t=0){var r;const n=this._reconnectionOptions.maxRetries;if(n>0&&t>=n)return void(null===(r=this.onerror)||void 0===r||r.call(this,new Error(`Maximum reconnection attempts (${n}) exceeded.`)));const a=this._getNextReconnectionDelay(t);setTimeout((()=>{this._startOrAuthSse(e).catch((r=>{var n;null===(n=this.onerror)||void 0===n||n.call(this,new Error(`Failed to reconnect SSE stream: ${r instanceof Error?r.message:String(r)}`)),this._scheduleReconnection(e,t+1)}))}),a)}_handleSseStream(e,t){if(!e)return;const{onresumptiontoken:r,replayMessageId:n}=t;let a;(async()=>{var t,o,i,s;try{const i=e.pipeThrough(new TextDecoderStream).pipeThrough(new $n).getReader();for(;;){const{value:e,done:s}=await i.read();if(s)break;if(e.id&&(a=e.id,null==r||r(e.id)),!e.event||"message"===e.event)try{const r=ar.parse(JSON.parse(e.data));void 0!==n&&tr(r)&&(r.id=n),null===(t=this.onmessage)||void 0===t||t.call(this,r)}catch(e){null===(o=this.onerror)||void 0===o||o.call(this,e)}}}catch(e){if(null===(i=this.onerror)||void 0===i||i.call(this,new Error(`SSE stream disconnected: ${e}`)),this._abortController&&!this._abortController.signal.aborted&&void 0!==a)try{this._scheduleReconnection({resumptionToken:a,onresumptiontoken:r,replayMessageId:n},0)}catch(e){null===(s=this.onerror)||void 0===s||s.call(this,new Error(`Failed to reconnect: ${e instanceof Error?e.message:String(e)}`))}}})()}async start(){if(this._abortController)throw new Error("StreamableHTTPClientTransport already started! If using Client class, note that connect() calls start() automatically.");this._abortController=new AbortController}async finishAuth(e){if(!this._authProvider)throw new Sn("No auth provider");if("AUTHORIZED"!==await Cn(this._authProvider,{serverUrl:this._url,authorizationCode:e}))throw new Sn("Failed to authorize")}async close(){var e,t;null===(e=this._abortController)||void 0===e||e.abort(),null===(t=this.onclose)||void 0===t||t.call(this)}async send(e,t){var r,n,a,o;try{const{resumptionToken:a,onresumptiontoken:i}=t||{};if(a)return void this._startOrAuthSse({resumptionToken:a,replayMessageId:Yt(e)?e.id:void 0}).catch((e=>{var t;return null===(t=this.onerror)||void 0===t?void 0:t.call(this,e)}));const s=await this._commonHeaders();s.set("content-type","application/json"),s.set("accept","application/json, text/event-stream");const l={...this._requestInit,method:"POST",headers:s,body:JSON.stringify(e),signal:null===(r=this._abortController)||void 0===r?void 0:r.signal},c=await fetch(this._url,l),d=c.headers.get("mcp-session-id");if(d&&(this._sessionId=d),!c.ok){if(401===c.status&&this._authProvider){if("AUTHORIZED"!==await Cn(this._authProvider,{serverUrl:this._url}))throw new Sn;return this.send(e)}const t=await c.text().catch((()=>null));throw new Error(`Error POSTing to endpoint (HTTP ${c.status}): ${t}`)}if(202===c.status)return o=e,void(pr.safeParse(o).success&&this._startOrAuthSse({resumptionToken:void 0}).catch((e=>{var t;return null===(t=this.onerror)||void 0===t?void 0:t.call(this,e)})));const u=(Array.isArray(e)?e:[e]).filter((e=>"method"in e&&"id"in e&&void 0!==e.id)).length>0,p=c.headers.get("content-type");if(u)if(null==p?void 0:p.includes("text/event-stream"))this._handleSseStream(c.body,{onresumptiontoken:i});else{if(!(null==p?void 0:p.includes("application/json")))throw new Rn(-1,`Unexpected content type: ${p}`);{const e=await c.json(),t=Array.isArray(e)?e.map((e=>ar.parse(e))):[ar.parse(e)];for(const e of t)null===(n=this.onmessage)||void 0===n||n.call(this,e)}}}catch(e){throw null===(a=this.onerror)||void 0===a||a.call(this,e),e}}get sessionId(){return this._sessionId}async terminateSession(){var e,t;if(this._sessionId)try{const t=await this._commonHeaders(),r={...this._requestInit,method:"DELETE",headers:t,signal:null===(e=this._abortController)||void 0===e?void 0:e.signal},n=await fetch(this._url,r);if(!n.ok&&405!==n.status)throw new Rn(n.status,`Failed to terminate session: ${n.statusText}`);this._sessionId=void 0}catch(e){throw null===(t=this.onerror)||void 0===t||t.call(this,e),e}}}var Nn=l(1269),Mn=l(143);const Dn="grafana-llm-app",Fn=`/api/plugins/${Dn}`;let Zn=new Mn.SemVer("0.2.0");const zn="mcp/grafana",Un=new Map,qn=t.createContext(null);function Vn(e,t){return`${e}-${t}`}function Gn({appName:e,appVersion:r,mcpAppName:n=Dn,mcpAppPath:a=zn,children:o}){const i=(0,t.useMemo)((()=>function({appName:e,appVersion:t,mcpAppName:r,mcpAppPath:n}){let a="pending",o=null,i=null;const s=Vn(e,t),l=(async()=>{if(Un.has(s)){if(o=Un.get(s),o.error)throw a="error",i=o.error,o.error;return a="success",o}try{const i=await async function(){try{const e=await(0,f.getBackendSrv)().get(`${Fn}/settings`,void 0,void 0,{showSuccessAlert:!1,showErrorAlert:!1});return!!e.enabled&&(void 0!==e.jsonData.mcp?.enabled?!!e.jsonData.mcp?.enabled:!e.jsonData.mcp?.disabled)}catch(e){return(0,f.logDebug)(String(e)),(0,f.logDebug)("Failed to check if LLM provider is enabled. This is expected if the Grafana LLM plugin is not installed, and the above error can be ignored."),!1}}();if(!i)return a="success",o={client:null,enabled:i},Un.set(s,o),o;const l=new vn({name:e,version:t}),c=new Ln(function(e=Dn,t=zn){let r=f.config.appUrl||"http://localhost:3000/";return r.endsWith("/")||(r=`${r}/`),t.startsWith("/")||(t=`/${t}`),new URL(`${r}api/plugins/${e}/resources${t}`)}(r,n),{reconnectionOptions:{maxRetries:5,initialReconnectionDelay:1e3,maxReconnectionDelay:5e3,reconnectionDelayGrowFactor:1.5}});return await l.connect(c),o={client:l,enabled:i},Un.set(s,o),a="success",o}catch(e){throw a="error",i=e,o={client:null,enabled:!1,error:i},Un.set(s,o),e}})();return{read(){if("pending"===a)throw l;if("error"===a)throw i;if("success"===a&&o)return o;throw new Error("Unexpected resource state")}}}({appName:e,appVersion:r,mcpAppName:n,mcpAppPath:a})),[e,r,n,a]).read();return t.useEffect((()=>()=>{i?.client&&i.client.close(),Un.delete(Vn(e,r))}),[i,e,r]),t.createElement(qn.Provider,{value:i},o)}function Bn(){const e=t.useContext(qn);if(null===e)throw new Error("MCP is not enabled in this Grafana instance.");return e}function Hn(e){return e.map(Wn)}function Wn(e){return{type:"function",function:{name:e.name,description:e.description,parameters:void 0!==e.inputSchema.properties?e.inputSchema:void 0}}}var Kn=l(2007);function Xn(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Jn(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Xn(o,n,a,i,s,"next",e)}function s(e){Xn(o,n,a,i,s,"throw",e)}i(void 0)}))}}function Yn(){const{client:e,enabled:t}=Bn(),{error:a,loading:o,value:i}=p(Jn((function*(){return t&&e?(yield e.listTools()).tools:null})),[e,t]);return t?o?r().createElement("div",{"data-testid":n.mcpTools.container},r().createElement("span",{"data-testid":n.mcpTools.loading},"Loading MCP tools...")):a?r().createElement("div",{"data-testid":n.mcpTools.container},r().createElement("span",{"data-testid":n.mcpTools.error},"Error loading MCP tools: ",a.message)):i&&0!==i.length?r().createElement("div",{"data-testid":n.mcpTools.container,style:{maxHeight:"400px",overflowY:"auto"}},r().createElement("h2",null,"Available MCP Tools"),r().createElement("ul",{"data-testid":n.mcpTools.list},i.map((e=>r().createElement("li",{key:e.name,"data-testid":n.mcpTools.toolItem},r().createElement("strong",{"data-testid":n.mcpTools.toolName},e.name),e.description&&r().createElement("span",{"data-testid":n.mcpTools.toolDescription}," - ",e.description)))))):r().createElement("div",{"data-testid":n.mcpTools.container},r().createElement("p",{"data-testid":n.mcpTools.empty},"No MCP tools available.")):r().createElement("div",{"data-testid":n.mcpTools.container},r().createElement("p",{"data-testid":n.mcpTools.disabled},"MCP is not enabled in this Grafana instance."))}function Qn(){return r().createElement(r().Suspense,{fallback:r().createElement("div",{"data-testid":n.mcpTools.container},"Connecting to MCP server...")},r().createElement(Kn.ErrorBoundary,null,(({error:e})=>e?r().createElement("div",{"data-testid":n.mcpTools.container},r().createElement("span",{"data-testid":n.mcpTools.error},"Error loading MCP tools: ",e.message)):r().createElement(Gn,{appName:"grafana-llm-app",appVersion:"0.21.1"},r().createElement(Yn,null)))))}var ea=l(6089);const ta=e=>"object"==typeof e&&null!==e&&"llmProvider"in e&&"vector"in e&&"version"in e,ra=new Set(["success","info","warning","error"]),na=e=>{return"ok"===e.toLowerCase()?"success":(t=e,ra.has(t)?e:"info");var t};function aa(e){var t;let n=na(null!==(t=e.status)&&void 0!==t?t:"error");if(!ta(e.details))return r().createElement(Kn.Alert,{severity:n,title:e.message});var a;n=((e,t)=>{const r=na(e);if("success"!==r)return r;if(!ta(t))return"success";if("object"==typeof t.llmProvider&&"object"==typeof t.vector){const e=!t.vector.enabled||t.vector.ok;return t.llmProvider.ok&&e?"success":"warning"}return r})(null!==(a=e.status)&&void 0!==a?a:"error",e.details);const o="boolean"==typeof e.details.llmProvider||"object"==typeof e.details.llmProvider&&e.details.llmProvider.configured,i="boolean"==typeof e.details.vector||"object"==typeof e.details.vector&&e.details.vector.enabled;return r().createElement(Kn.Stack,{direction:"column"},r().createElement(oa,null),o&&r().createElement(ia,{provider:e.details.llmProvider}),i&&r().createElement(sa,{vector:e.details.vector}))}function oa(){return f.config.liveEnabled?null:r().createElement(Kn.Alert,{title:"Grafana Live is disabled",severity:"warning"},r().createElement("div",null,"Grafana Live is disabled. This plugin requires Grafana Live to be enabled in order to function correctly."),r().createElement("div",null,"Set the"," ",r().createElement("a",{href:"https://grafana.com/docs/grafana/latest/setup-grafana/configure-grafana/#max_connections"},r().createElement("code",null,"max_connections"))," ","setting to a non-zero value in the Grafana configuration file to enable Grafana Live."))}function ia({provider:e}){if("boolean"==typeof e){const t=e?"success":"error",n=e?"LLM provider health check succeeded!":"LLM provider health check failed.";return r().createElement(Kn.Alert,{title:n,severity:t})}const t=e.ok?"LLM provider health check succeeded!":"LLM provider health check failed.",n=e.ok?"success":"error";return r().createElement(Kn.Stack,{direction:"column",width:"100%"},r().createElement(Kn.Alert,{severity:n,title:t},r().createElement("b",null,"Models"),r().createElement("div",null,Object.entries(e.models).map((([e,t],n)=>r().createElement("li",{key:n},e,": ",t.ok?"OK":`Error: ${t.error}`))))))}function sa({vector:e}){if("boolean"==typeof e){const t=e?"success":"error",n=e?"Vector service health check succeeded!":"Vector service health check failed.";return r().createElement(Kn.Alert,{title:n,severity:t})}const t=e.ok?"success":"error",n=e.ok?"Vector service health check succeeded!":"Vector service health check failed.";return r().createElement(Kn.Alert,{title:n,severity:t},e.error&&r().createElement("div",null,"Error: ",e.error))}function la(e){return"function"==typeof e}function ca(e){return function(t){if(function(e){return la(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}var da,ua=((da=function(e){var t;t=this,Error.call(t),t.stack=(new Error).stack,this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}).prototype=Object.create(Error.prototype),da.prototype.constructor=da,da);function pa(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var ha=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,n,a;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var i=s(o),l=i.next();!l.done;l=i.next())l.value.remove(this)}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}else o.remove(this);var c=this.initialTeardown;if(la(c))try{c()}catch(e){a=e instanceof ua?e.errors:[e]}var p=this._finalizers;if(p){this._finalizers=null;try{for(var h=s(p),m=h.next();!m.done;m=h.next()){var f=m.value;try{ma(f)}catch(e){a=null!=a?a:[],e instanceof ua?a=u(u([],d(a)),d(e.errors)):a.push(e)}}}catch(e){r={error:e}}finally{try{m&&!m.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}}if(a)throw new ua(a)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)ma(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&pa(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&pa(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function ma(e){la(e)?e():e.unsubscribe()}ha.EMPTY;var fa=null,ga=null,va=!1,ya=!1,ba={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var a=ba.delegate;return(null==a?void 0:a.setTimeout)?a.setTimeout.apply(a,u([e,t],d(r))):setTimeout.apply(void 0,u([e,t],d(r)))},clearTimeout:function(e){var t=ba.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function _a(){}var Ea=wa("C",void 0,void 0);function wa(e,t,r){return{kind:e,value:t,error:r}}var xa=function(e){function t(t){var r,n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,((r=t)instanceof ha||r&&"closed"in r&&la(r.remove)&&la(r.add)&&la(r.unsubscribe))&&t.add(n)):n.destination=Aa,n}return o(t,e),t.create=function(e,t,r){return new Ca(e,t,r)},t.prototype.next=function(e){this.isStopped?Ta(function(e){return wa("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Ta(wa("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Ta(Ea,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(ha),Oa=Function.prototype.bind;function ka(e,t){return Oa.call(e,t)}var Sa=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Ia(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Ia(e)}else Ia(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Ia(e)}},e}(),Ca=function(e){function t(t,r,n){var a,o,i=e.call(this)||this;return la(t)||!t?a={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:i&&ya?((o=Object.create(t)).unsubscribe=function(){return i.unsubscribe()},a={next:t.next&&ka(t.next,o),error:t.error&&ka(t.error,o),complete:t.complete&&ka(t.complete,o)}):a=t,i.destination=new Sa(a),i}return o(t,e),t}(xa);function Ia(e){va||function(e){ba.setTimeout((function(){if(!fa)throw e;fa(e)}))}(e)}function Ta(e,t){var r=ga;r&&ba.setTimeout((function(){return r(e,t)}))}var Aa={closed:!0,next:_a,error:function(e){throw e},complete:_a};function Pa(e,t,r,n,a){return new $a(e,t,r,n,a)}var $a=function(e){function t(t,r,n,a,o,i){var s=e.call(this,t)||this;return s.onFinalize=o,s.shouldUnsubscribe=i,s._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=a?function(e){try{a(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return o(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(xa);function ja(e,t){return ca((function(r,n){var a=0;r.subscribe(Pa(n,(function(r){return e.call(t,r,a++)&&n.next(r)})))}))}function Ra(e,t){return ca((function(r,n){var a=0;r.subscribe(Pa(n,(function(r){n.next(e.call(t,r,a++))})))}))}function La(e,t,r,n,a){return function(o,i){var s=r,l=t,c=0;o.subscribe(Pa(i,(function(t){var r=c++;l=s?e(l,t,r):(s=!0,t),n&&i.next(l)}),a&&function(){s&&i.next(l),i.complete()}))}}function Na(e){return e}var Ma=function(e,t){return e.push(t),e};const Da={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let Fa;const Za=new Uint8Array(16),za=[];for(let e=0;e<256;++e)za.push((e+256).toString(16).slice(1));const Ua=function(e,t,r){if(Da.randomUUID&&!t&&!e)return Da.randomUUID();const n=(e=e||{}).random??e.rng?.()??function(){if(!Fa){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Fa=crypto.getRandomValues.bind(crypto)}return Fa(Za)}();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){if((r=r||0)<0||r+16>t.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return(za[e[t+0]]+za[e[t+1]]+za[e[t+2]]+za[e[t+3]]+"-"+za[e[t+4]]+za[e[t+5]]+"-"+za[e[t+6]]+za[e[t+7]]+"-"+za[e[t+8]]+za[e[t+9]]+"-"+za[e[t+10]]+za[e[t+11]]+za[e[t+12]]+za[e[t+13]]+za[e[t+14]]+za[e[t+15]]).toLowerCase()}(n)},qa="llm/v1/chat/completions";var Va=(e=>(e.BASE="base",e.LARGE="large",e))(Va||{});function Ga(e){return"error"in e}function Ba(e){return"tool_calls"in e&&null!=e.tool_calls}function Ha(){return(0,Nn.pipe)((0,Nn.pipe)(ja((e=>"content"in e.choices[0].delta)),Ra((e=>e.choices[0].delta.content))),function(e,t){return ca(La(e,t,arguments.length>=2,!0))}(((e,t)=>e+t),""))}async function Wa(e){return await(0,f.getBackendSrv)().post(`/api/plugins/grafana-llm-app/resources/${qa}`,e,{headers:{"Content-Type":"application/json"}})}function Ka(t){const r={scope:e.LiveChannelScope.Plugin,namespace:Dn,path:qa+"/"+Ua(),data:t};return(0,f.getGrafanaLiveSrv)().getStream(r).pipe(ja((t=>(0,e.isLiveChannelMessageEvent)(t)))).pipe(ja((e=>!!e.message.choices)),(l=la(o=e=>{if(Ga(e.message))throw new Error(e.message.error)})?{next:o,error:i,complete:s}:o)?ca((function(e,t){var r;null===(r=l.subscribe)||void 0===r||r.call(l);var n=!0;e.subscribe(Pa(t,(function(e){var r;null===(r=l.next)||void 0===r||r.call(l,e),t.next(e)}),(function(){var e;n=!1,null===(e=l.complete)||void 0===e||e.call(l),t.complete()}),(function(e){var r;n=!1,null===(r=l.error)||void 0===r||r.call(l,e),t.error(e)}),(function(){var e,t;n&&(null===(e=l.unsubscribe)||void 0===e||e.call(l)),null===(t=l.finalize)||void 0===t||t.call(l)})))})):Na,(n=e=>!(!Ga(e.message)&&(e.message.choices&&e.message.choices[0].delta&&"done"in e.message.choices[0].delta&&!0===e.message.choices[0].delta.done||e.message.choices&&"finish_reason"in e.message.choices[0]&&"stop"===e.message.choices[0].finish_reason)),void 0===a&&(a=!1),ca((function(e,t){e.subscribe(Pa(t,(function(e){var r=n(e,0);(r||a)&&t.next(e),!r&&t.complete()})))}))),Ra((e=>e.message)));var n,a,o,i,s,l}let Xa=!1;const Ja=async()=>{const e=await(async()=>{try{if(!(await(0,f.getBackendSrv)().get(`${Fn}/settings`,void 0,void 0,{showSuccessAlert:!1,showErrorAlert:!1})).enabled)return{configured:!1,ok:!1,error:"The Grafana LLM plugin is not enabled."}}catch(e){return(0,f.logDebug)(String(e)),(0,f.logDebug)("Failed to check if LLM provider is enabled. This is expected if the Grafana LLM plugin is not installed, and the above error can be ignored."),Xa=!0,{configured:!1,ok:!1,error:"The Grafana LLM plugin is not installed."}}let e;try{e=await(0,f.getBackendSrv)().get(`${Fn}/health`,void 0,void 0,{showSuccessAlert:!1,showErrorAlert:!1})}catch(e){return Xa||((0,f.logDebug)(String(e)),(0,f.logDebug)("Failed to check if LLM provider is enabled. This is expected if the Grafana LLM plugin is not installed, and the above error can be ignored."),Xa=!0),{configured:!1,ok:!1,error:"The Grafana LLM plugin is not installed."}}const{details:t}=e;return void 0!==t?.version&&function(e){try{Zn=new Mn.SemVer(e)}catch(e){(0,f.logWarning)("Failed to parse version of grafana-llm-app; assuming old version is present.")}}(t.version),void 0===t?.llmProvider?{configured:!1,ok:!1,error:"The Grafana LLM plugin is outdated; please update it."}:"boolean"==typeof t.llmProvider?{configured:t.llmProvider,ok:t.llmProvider}:t.llmProvider})();return e.configured&&e.ok};function Ya(){return(0,Nn.pipe)(ja((e=>Ba(e.choices[0].delta))),ca((function(e,t){(function(e,t){return ca(La(e,t,arguments.length>=2,!1,!0))})(Ma,[])(e).subscribe(t)})),Ra((e=>function(e){const t={role:"assistant",tool_calls:[]};for(const r of e)for(const e of r.tool_calls)e.index>=t.tool_calls.length?t.tool_calls.push({...e,function:{...e.function,arguments:e.function.arguments??""}}):t.tool_calls[e.index].function.arguments+=e.function.arguments??"";for(const e of t.tool_calls)e.function.arguments||(e.function.arguments="{}");return t}(e.map((e=>e.choices[0].delta))))))}function Qa(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Qa(e,t,r[t])}))}return e}function to(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ro=Va.BASE,no=(e,t,r)=>{var n;return{default:null!==(n=t.default)&&void 0!==n?n:ro,mapping:t.mapping?Object.fromEntries(Object.entries(t.mapping).filter((([e,t])=>r.find((t=>t.id===e))))):Object.fromEntries(r.map((e=>[e.id,e.name])))}};function ao({provider:e,settings:t,onChange:n}){const a=function(e){return"anthropic"===e?[{id:Va.BASE,name:"claude-4-sonnet-20250514",label:"Base",description:"An effective, balanced model, suitable for most tasks."},{id:Va.LARGE,name:"claude-4-sonnet-20250514",label:"Large",description:"An effective, balanced model, suitable for most tasks."}]:[{id:Va.BASE,name:"gpt-4.1-mini",label:"Base",description:"A fast and cost-effective model for efficient, high-throughput tasks."},{id:Va.LARGE,name:"gpt-4.1",label:"Large",description:"A larger, higher cost model for more advanced tasks with longer context windows."}]}(e);t=no(e,t,a);const o=e=>n(to(eo({},t),{default:e}));var i;return r().createElement(Kn.FieldSet,null,"azure"===e&&r().createElement(Kn.Field,{label:"Default Model",description:"The default model is used when no model is specified in the chat request."},r().createElement(Kn.Select,{options:a.map((e=>({label:e.label,value:e.id}))),width:60,value:null!==(i=t.default)&&void 0!==i?i:ro,onChange:e=>{var t;return o(null!==(t=e.value)&&void 0!==t?t:ro)}})),"azure"!==e&&r().createElement(r().Fragment,null,r().createElement(Kn.Label,{description:"Map custom models used for LLM features. The default model is used when no model is specified in the chat request."},"Model mappings"),a.map(((e,a)=>{const i=t.mapping[e.id],s=t.default===e.id,l=r().createElement(r().Fragment,null,r().createElement(Kn.Label,null,e.label,r().createElement(Kn.Divider,{direction:"vertical",spacing:1}),s?r().createElement("div",{style:{margin:"1px auto"}},r().createElement(Kn.Badge,{text:"Default",color:"blue"})):r().createElement(Kn.Button,{variant:"secondary",size:"sm",onClick:()=>o(e.id)},"Set as default")));return r().createElement(Kn.Field,{key:a,label:l,description:e.description},r().createElement(Kn.Input,{width:60,type:"text",name:"model",value:i,placeholder:e.name,onChange:r=>{const a=r.currentTarget.value,o=to(eo({},t.mapping),{[e.id]:a||void 0});n(to(eo({},t),{mapping:o}))}}))}))))}function oo(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function io(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){oo(o,n,a,i,s,"next",e)}function s(e){oo(o,n,a,i,s,"throw",e)}i(void 0)}))}}function so(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){so(e,t,r[t])}))}return e}function co(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function uo(e,t,r,n,a){return po.apply(this,arguments)}function po(){return(po=io((function*(e,t,r,n,a){const{function:o,id:i}=e;console.log("f",o),n(new Map(r.set(i,{name:o.name,arguments:o.arguments,running:!0})));const s=JSON.parse(o.arguments);try{const e=yield t.callTool({name:o.name,arguments:s}),l=Kr.parse(e).content.filter((e=>"text"===e.type)).map((e=>e.text)).join("");a.push({role:"tool",tool_call_id:i,content:l}),n(new Map(r.set(i,{name:o.name,arguments:o.arguments,running:!1,response:e})))}catch(e){var l;const t=null!==(l=e.message)&&void 0!==l?l:e.toString();a.push({role:"tool",tool_call_id:i,content:t}),n(new Map(r.set(i,{name:o.name,arguments:o.arguments,running:!1,error:t})))}}))).apply(this,arguments)}function ho({useStream:e,toolCalls:n,setToolCalls:a}){const{client:o}=Bn(),[i,s]=(0,t.useState)([]),[l,c]=(0,t.useState)(""),[d,u]=(0,t.useState)(!1),h=(0,t.useRef)(null);(0,t.useEffect)((()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)}),[i]);const{loading:m,error:f,value:g}=p(io((function*(){if(!(yield Ja()))return{enabled:!1,tools:[]};var e;const{tools:t}=null!==(e=yield null==o?void 0:o.listTools())&&void 0!==e?e:{tools:[]};return{enabled:!0,tools:t}})),[o]),v=(y=io((function*(e,t){let r=Ka({model:Va.LARGE,messages:e,tools:Hn(t)}),[i,l]=(0,Nn.partition)(r,(e=>Ba(e.choices[0].delta))),c=l.pipe(Ha(),(0,Nn.finalize)((()=>{console.log("stream finalized")})));c.subscribe((e=>{s((t=>t.map(((r,n)=>n===t.length-1&&"assistant"===r.role?co(lo({},r),{content:e}):r))))}));let d=yield(0,Nn.lastValueFrom)(i.pipe(Ya()));for(;d.tool_calls.length>0;){e.push(d);const u=d.tool_calls.filter((e=>"function"===e.type));yield Promise.all(u.map((t=>uo(t,o,n,a,e)))),r=Ka({model:Va.LARGE,messages:e,tools:Hn(t)}),[i,l]=(0,Nn.partition)(r,(e=>Ba(e.choices[0].delta)));const p={choices:[{delta:{role:"assistant",content:""}}]};c=l.pipe((0,Nn.startWith)(p),Ha(),(0,Nn.finalize)((()=>{console.log("stream finalized")}))),c.subscribe((e=>{s((t=>t.map(((r,n)=>n===t.length-1&&"assistant"===r.role?co(lo({},r),{content:e}):r))))})),d=yield(0,Nn.lastValueFrom)(i.pipe(Ya()))}})),function(e,t){return y.apply(this,arguments)});var y;const b=function(){var e=io((function*(e,t){var r;let i=yield Wa({model:Va.BASE,messages:e,tools:Hn(t)});var l;let c=null!==(l=null===(r=i.choices[0].message.tool_calls)||void 0===r?void 0:r.filter((e=>"function"===e.type)))&&void 0!==l?l:[];for(;c.length>0;){var d,u;e.push(i.choices[0].message),yield Promise.all(c.map((t=>uo(t,o,n,a,e)))),i=yield Wa({model:Va.LARGE,messages:e,tools:Hn(t)}),c=null!==(u=null===(d=i.choices[0].message.tool_calls)||void 0===d?void 0:d.filter((e=>"function"===e.type)))&&void 0!==u?u:[]}s((e=>e.map(((t,r)=>r===e.length-1&&"assistant"===t.role?co(lo({},t),{content:i.choices[0].message.content||""}):t))))}));return function(t,r){return e.apply(this,arguments)}}(),_=function(){var t=io((function*(){if(!l.trim()||d||!(null==g?void 0:g.enabled))return;const t={role:"user",content:l.trim(),timestamp:new Date};s((e=>[...e,t])),c(""),u(!0),a(new Map);const r={role:"assistant",content:"",timestamp:new Date};s((e=>[...e,r]));const n=[{role:"system",content:"You are a helpful assistant with deep knowledge of the Grafana, Prometheus and general observability ecosystem."},...i.map((e=>({role:e.role,content:e.content}))),{role:"user",content:t.content}];try{e?yield v(n,g.tools):yield b(n,g.tools)}catch(e){console.error("Error in chat completion:",e),s((t=>t.map(((r,n)=>n===t.length-1&&"assistant"===r.role?co(lo({},r),{content:`Error: ${e instanceof Error?e.message:"Unknown error"}`}):r))))}finally{u(!1)}}));return function(){return t.apply(this,arguments)}}();return f?r().createElement("div",null,"Error: ",f.message):(null==g?void 0:g.enabled)?r().createElement(Kn.Stack,{direction:"column",gap:3},r().createElement("div",{ref:h,style:{height:"400px",overflowY:"auto",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"16px",backgroundColor:"var(--background-color-secondary)"}},0===i.length?r().createElement("div",{style:{color:"var(--text-color-secondary)",fontStyle:"italic"}},"Start a conversation by typing a message below..."):r().createElement(Kn.Stack,{direction:"column",gap:1},i.map(((e,t)=>r().createElement("div",{key:t,style:{display:"flex",flexDirection:"row",marginBottom:"12px",width:"100%"}},r().createElement("div",{style:{maxWidth:"90%",padding:"10px 14px",borderRadius:"12px",backgroundColor:"user"===e.role?"#007acc":"var(--background-color-primary)",color:"user"===e.role?"white":"var(--text-color-primary)",whiteSpace:"pre-wrap",wordBreak:"break-word",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.1)",border:"assistant"===e.role?"1px solid var(--border-color)":"none",fontSize:"14px",lineHeight:"1.4"}},e.content||("assistant"===e.role&&d&&t===i.length-1?r().createElement("span",{style:{opacity:.7}},"..."):""))))))),r().createElement(Kn.Stack,{direction:"row",gap:2},r().createElement(Kn.TextArea,{value:l,onChange:e=>c(e.currentTarget.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_())},placeholder:"Type your message... (Enter to send, Shift+Enter for new line)",disabled:d,style:{flex:1},rows:3}),r().createElement(Kn.Button,{onClick:_,disabled:!l.trim()||d||m,variant:"primary"},d?r().createElement(Kn.Spinner,{size:"sm"}):"Send"))):r().createElement("div",null,"LLM plugin not enabled.")}function mo(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){mo(e,t,r[t])}))}return e}function go(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const vo=r().memo((({field:e,value:t,onChange:n})=>{const a=e=>{n(e)},o={label:e.name,description:e.description,required:e.required};if(e.enum&&e.enum.length>0){const n=e.enum.map((e=>({label:e,value:e})));return r().createElement(Kn.Field,o,r().createElement(Kn.Select,{options:n,value:t,onChange:e=>a(null==e?void 0:e.value),placeholder:e.example?`e.g., ${e.example}`:`Select ${e.name}...`,isClearable:!e.required}))}switch(e.type){case"boolean":return r().createElement(Kn.Field,o,r().createElement(Kn.Switch,{value:Boolean(t),onChange:e=>a(e.currentTarget.checked)}));case"number":case"integer":return r().createElement(Kn.Field,o,r().createElement(Kn.Input,{type:"number",value:t||"",onChange:t=>{const r="integer"===e.type?parseInt(t.currentTarget.value,10):parseFloat(t.currentTarget.value);a(isNaN(r)?void 0:r)},placeholder:e.example?`e.g., ${e.example}`:void 0}));case"array":return r().createElement(Kn.Field,go(fo({},o),{description:`${e.description||""} (Enter one item per line)`}),r().createElement(Kn.TextArea,{value:Array.isArray(t)?t.join("\n"):"",onChange:e=>{const t=e.currentTarget.value.split("\n").filter((e=>e.trim()));a(t.length>0?t:void 0)},placeholder:e.example?`e.g.,\n${Array.isArray(e.example)?e.example.join("\n"):e.example}`:"Enter items, one per line",rows:3}));case"object":return r().createElement(Kn.Field,go(fo({},o),{description:`${e.description||""} (Enter valid JSON)`}),r().createElement(Kn.TextArea,{value:"object"==typeof t?JSON.stringify(t,null,2):t||"",onChange:e=>{try{const t=JSON.parse(e.currentTarget.value);a(t)}catch(t){a(e.currentTarget.value)}},placeholder:e.example?`e.g.,\n${JSON.stringify(e.example,null,2)}`:'{\n  "key": "value"\n}',rows:4}));default:return e.description&&e.description.length>100||e.name.toLowerCase().includes("description")||e.name.toLowerCase().includes("query")||e.name.toLowerCase().includes("message")?r().createElement(Kn.Field,o,r().createElement(Kn.TextArea,{value:t||"",onChange:e=>a(e.currentTarget.value||void 0),placeholder:e.example?`e.g., ${e.example}`:void 0,rows:3})):r().createElement(Kn.Field,o,r().createElement(Kn.Input,{value:t||"",onChange:e=>a(e.currentTarget.value||void 0),placeholder:e.example?`e.g., ${e.example}`:void 0}))}}));function yo({schema:e,onParametersChange:n,onSubmit:a,isLoading:o}){const[i,s]=(0,t.useState)({}),l=(0,t.useMemo)((()=>function(e){if(!(null==e?void 0:e.properties))return[];const t=e.required||[];return Object.entries(e.properties).map((([e,r])=>({name:e,type:r.type||"string",required:t.includes(e),description:r.description,example:r.example,enum:r.enum,default:r.default})))}(e)),[e]);(0,t.useEffect)((()=>{const e={};l.forEach((t=>{void 0!==t.default&&(e[t.name]=t.default)})),s(e)}),[l]),(0,t.useEffect)((()=>{const e=Object.entries(i).reduce(((e,[t,r])=>(void 0!==r&&""!==r&&null!==r&&(e[t]=r),e)),{}),t=setTimeout((()=>{n(e)}),100);return()=>clearTimeout(t)}),[i,n]);const c=(0,t.useCallback)(((e,t)=>{s((r=>go(fo({},r),{[e]:t})))}),[]),d=()=>l.every((e=>{if(!e.required)return!0;const t=i[e.name];return void 0!==t&&""!==t&&null!==t}));return 0===l.length?r().createElement("div",{style:{padding:"16px",textAlign:"center"}},r().createElement("p",{style:{color:"var(--text-color-secondary)",marginBottom:"16px"}},"This tool requires no parameters."),r().createElement(Kn.Button,{variant:"primary",onClick:a,disabled:o},o?"Running...":"Run Tool")):r().createElement("div",{style:{padding:"16px"}},r().createElement("div",{style:{marginBottom:"20px"}},l.map((e=>r().createElement("div",{key:e.name,style:{marginBottom:"16px"}},r().createElement(vo,{field:e,value:i[e.name],onChange:t=>c(e.name,t)}))))),r().createElement(Kn.Button,{variant:"primary",onClick:a,disabled:o||!d(),style:{width:"100%"}},o?"Running...":"Run Tool"),!d()&&r().createElement("div",{style:{marginTop:"8px",fontSize:"12px",color:"var(--error-color)",textAlign:"center"}},"Please fill in all required fields"))}function bo(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function _o(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){bo(o,n,a,i,s,"next",e)}function s(e){bo(o,n,a,i,s,"throw",e)}i(void 0)}))}}vo.displayName="FormFieldComponent";const Eo={list_teams:"Admin",list_users_by_org:"Admin",search_dashboards:"Search",get_dashboard_by_uid:"Dashboard",update_dashboard:"Dashboard",get_dashboard_panel_queries:"Dashboard",list_datasources:"Datasources",get_datasource_by_uid:"Datasources",get_datasource_by_name:"Datasources",query_prometheus:"Prometheus",list_prometheus_metric_metadata:"Prometheus",list_prometheus_metric_names:"Prometheus",list_prometheus_label_names:"Prometheus",list_prometheus_label_values:"Prometheus",list_incidents:"Incident",create_incident:"Incident",add_activity_to_incident:"Incident",get_incident:"Incident",query_loki_logs:"Loki",list_loki_label_names:"Loki",list_loki_label_values:"Loki",query_loki_stats:"Loki",list_alert_rules:"Alerting",get_alert_rule_by_uid:"Alerting",list_contact_points:"Alerting",list_oncall_schedules:"OnCall",get_oncall_shift:"OnCall",get_current_oncall_users:"OnCall",list_oncall_teams:"OnCall",list_oncall_users:"OnCall",get_sift_investigation:"Sift",get_sift_analysis:"Sift",list_sift_investigations:"Sift",find_error_pattern_logs:"Sift",find_slow_requests:"Sift",list_pyroscope_label_names:"Pyroscope",list_pyroscope_label_values:"Pyroscope",list_pyroscope_profile_types:"Pyroscope",fetch_pyroscope_profile:"Pyroscope",get_assertions:"Asserts"},wo=r().memo((({tool:e})=>{var n,a;const{client:o}=Bn(),[i,s]=(0,t.useState)(!1),[l,c]=(0,t.useState)("{}"),[d,u]=(0,t.useState)({}),[p,h]=(0,t.useState)("form"),[m,f]=(0,t.useState)(null),g=(0,t.useCallback)((e=>{u(e)}),[]),v=(0,t.useCallback)(_o((function*(){if(o){f({loading:!0});try{let t={};if("form"===p)t=d;else if(l.trim())try{t=JSON.parse(l)}catch(e){return void f({loading:!1,success:!1,error:`Invalid JSON parameters: ${e instanceof Error?e.message:"Unknown error"}`})}const r=yield o.callTool({name:e.name,arguments:t});f({loading:!1,success:!0,response:r})}catch(e){f({loading:!1,success:!1,error:e instanceof Error?e.message:"Unknown error"})}}})),[o,p,d,l,e.name]),y=(0,t.useCallback)((()=>{var t;if(!(null===(t=e.inputSchema)||void 0===t?void 0:t.properties))return"{}";const r={},n=e.inputSchema.properties;return Object.keys(n).forEach((e=>{const t=n[e];t&&"object"==typeof t&&("string"===t.type?r[e]=t.example||"example_value":"number"===t.type?r[e]=t.example||42:"boolean"===t.type?r[e]=t.example||!0:"array"===t.type?r[e]=t.example||[]:"object"===t.type?r[e]=t.example||{}:r[e]=t.example||null)})),JSON.stringify(r,null,2)}),[e.inputSchema]),b=(0,t.useCallback)((()=>{c(y())}),[y]);return r().createElement("div",{style:{border:"1px solid var(--border-color)",borderRadius:"8px",marginBottom:"12px",backgroundColor:"var(--background-color-primary)"}},r().createElement("div",{style:{padding:"12px 16px",borderBottom:i?"1px solid var(--border-color)":"none",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center"},onClick:()=>s(!i)},r().createElement("div",{style:{flex:1}},r().createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"}},r().createElement("code",{style:{fontWeight:500,fontSize:"15px",backgroundColor:"var(--background-color-secondary)",padding:"2px 6px",borderRadius:"3px",border:"1px solid var(--border-color)"}},e.name),(null===(n=e.annotations)||void 0===n?void 0:n.title)&&e.annotations.title!==e.name&&r().createElement("span",{style:{fontSize:"14px",color:"var(--text-color-secondary)"}},"(",e.annotations.title,")")),e.description&&r().createElement("div",{style:{fontSize:"13px",color:"var(--text-color-secondary)",lineHeight:"1.4",marginBottom:"4px"}},e.description),r().createElement("div",{style:{display:"flex",gap:"12px",fontSize:"12px",color:"var(--text-color-secondary)"}},(()=>{var t;const n=null===(t=e.inputSchema)||void 0===t?void 0:t.properties,a=n&&"object"==typeof n&&null!==n?Object.keys(n).length:0;return a>0?r().createElement("span",null,"Parameters: ",a):null})(),(()=>{var t;const n=null===(t=e.inputSchema)||void 0===t?void 0:t.required,a=Array.isArray(n)?n.length:0;return a>0?r().createElement("span",null,"Required: ",a):null})())),r().createElement(Kn.Icon,{name:i?"angle-up":"angle-down"})),i&&r().createElement("div",{style:{padding:"16px"}},r().createElement("div",{style:{marginBottom:"20px"}},r().createElement("h4",{style:{margin:"0 0 8px 0",fontSize:"14px"}},"Input Schema"),r().createElement("pre",{style:{backgroundColor:"var(--background-color-secondary)",padding:"12px",borderRadius:"4px",fontSize:"12px",lineHeight:"1.4",overflow:"auto",maxHeight:"200px",border:"1px solid var(--border-color)"}},(e=>{if(!e)return"No schema available";try{return JSON.stringify(e,null,2)}catch(t){return String(e)}})(e.inputSchema))),r().createElement("div",{style:{marginBottom:"16px"}},r().createElement("div",{style:{marginBottom:"12px"}},r().createElement("h4",{style:{margin:"0 0 8px 0",fontSize:"14px"}},"Test Parameters"),r().createElement(Kn.TabsBar,null,r().createElement(Kn.Tab,{label:"Form",active:"form"===p,onChangeTab:()=>h("form")}),r().createElement(Kn.Tab,{label:"JSON",active:"json"===p,onChangeTab:()=>h("json")}))),"form"===p?r().createElement(yo,{schema:e.inputSchema,onParametersChange:g,onSubmit:v,isLoading:null==m?void 0:m.loading}):r().createElement("div",null,r().createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}},r().createElement("span",{style:{fontSize:"12px",color:"var(--text-color-secondary)"}},"JSON Mode"),r().createElement(Kn.Button,{variant:"secondary",size:"sm",onClick:b,disabled:!(null===(a=e.inputSchema)||void 0===a?void 0:a.properties)},"Fill Example")),r().createElement(Kn.TextArea,{value:l,onChange:e=>c(e.currentTarget.value),placeholder:"Enter JSON parameters for testing...",rows:4,style:{fontFamily:"monospace",fontSize:"12px"}}),r().createElement("div",{style:{marginTop:"12px"}},r().createElement(Kn.Button,{variant:"primary",size:"sm",onClick:v,disabled:(null==m?void 0:m.loading)||!o},(null==m?void 0:m.loading)?r().createElement(Kn.Spinner,{size:"sm"}):"Test Tool")))),m&&!m.loading&&r().createElement("div",{style:{marginTop:"16px"}},r().createElement("h4",{style:{margin:"0 0 8px 0",fontSize:"14px"}},"Result"," ",m.success?r().createElement(Kn.Icon,{name:"check",style:{color:"var(--success-color)",marginLeft:"8px"}}):r().createElement(Kn.Icon,{name:"exclamation-triangle",style:{color:"var(--error-color)",marginLeft:"8px"}})),m.error?r().createElement("div",{style:{backgroundColor:"var(--error-background)",color:"var(--error-text-color)",padding:"12px",borderRadius:"4px",fontSize:"13px"}},m.error):r().createElement("pre",{style:{backgroundColor:"var(--background-color-secondary)",padding:"12px",borderRadius:"4px",fontSize:"12px",lineHeight:"1.4",overflow:"auto",maxHeight:"300px",border:"1px solid var(--border-color)"}},JSON.stringify(m.response,null,2)))))}));function xo({tools:e}){const[n,a]=(0,t.useState)(""),o=r().useMemo((()=>{const t=n.toLowerCase();return e.filter((e=>{var r;const n=e.name.toLowerCase();var a;const o=(null!==(a=null===(r=e.annotations)||void 0===r?void 0:r.title)&&void 0!==a?a:"").toLowerCase(),i=(e.description||"").toLowerCase();return n.includes(t)||o.includes(t)||i.includes(t)}))}),[e,n]),{groupedTools:i,sortedCategories:s}=r().useMemo((()=>{const e=o.reduce(((e,t)=>{const r=Eo[t.name]||"Ungrouped";return e[r]||(e[r]=[]),e[r].push(t),e}),{});return{groupedTools:e,sortedCategories:Object.keys(e).sort(((e,t)=>"Ungrouped"===e?1:"Ungrouped"===t?-1:e.localeCompare(t)))}}),[o]);return 0===e.length?r().createElement("div",{style:{color:"var(--text-color-secondary)",fontStyle:"italic",textAlign:"center",padding:"24px"}},"No MCP tools available"):r().createElement("div",null,r().createElement("div",{style:{marginBottom:"16px"}},r().createElement("input",{type:"text",placeholder:"Search tools...",value:n,onChange:e=>a(e.target.value),style:{width:"100%",padding:"8px 12px",border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--background-color-primary)",fontSize:"14px"}})),r().createElement("div",null,0===o.length?r().createElement("div",{style:{color:"var(--text-color-secondary)",fontStyle:"italic",textAlign:"center",padding:"24px"}},"No tools match your search"):s.map((e=>r().createElement(Kn.CollapsableSection,{key:e,label:`${e} (${i[e].length})`,isOpen:!0},r().createElement("div",{style:{marginTop:"8px"}},i[e].map((e=>r().createElement(wo,{key:e.name,tool:e})))))))))}function Oo(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function ko(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Oo(o,n,a,i,s,"next",e)}function s(e){Oo(o,n,a,i,s,"throw",e)}i(void 0)}))}}function So(){var e;const{client:n}=Bn(),[a,o]=(0,t.useState)("chat"),[i,s]=(0,t.useState)(!0),[l,c]=(0,t.useState)(new Map),{loading:d,error:u,value:h}=p(ko((function*(){if(!(yield Ja()))return{enabled:!1,tools:[]};var e;const{tools:t}=null!==(e=yield null==n?void 0:n.listTools())&&void 0!==e?e:{tools:[]};return{enabled:!0,tools:t}})),[n]);return u?r().createElement("div",null,"Error: ",u.message):(null==h?void 0:h.enabled)?r().createElement(r().Fragment,null,r().createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"}},r().createElement(Kn.TabsBar,null,r().createElement(Kn.Tab,{label:"Chat",active:"chat"===a,onChangeTab:()=>o("chat")}),r().createElement(Kn.Tab,{label:"Tool Inspector",active:"tools"===a,onChangeTab:()=>o("tools"),counter:(null==h||null===(e=h.tools)||void 0===e?void 0:e.length)||0})),"chat"===a&&r().createElement(Kn.Checkbox,{label:"Streaming",value:i,onChange:e=>s(e.currentTarget.checked)})),r().createElement("div",{style:{paddingTop:10,minHeight:400,display:"flex",flexDirection:"column"}},"chat"===a&&r().createElement(ho,{useStream:i,toolCalls:l,setToolCalls:c}),"tools"===a&&r().createElement(xo,{tools:(null==h?void 0:h.tools)||[]}))):r().createElement("div",null,"LLM plugin not enabled.")}wo.displayName="ToolInspector";const Co=()=>{const[e,n]=(0,t.useState)(!1),a=()=>{n(!1)};return r().createElement(Kn.FieldSet,{label:"Development Sandbox"},r().createElement(Kn.Button,{onClick:()=>n(!0)},"Open development sandbox"),r().createElement(Kn.Modal,{title:"Development Sandbox",isOpen:e,onDismiss:a},r().createElement(t.Suspense,{fallback:r().createElement(Kn.LoadingPlaceholder,{text:"Loading MCP..."})},r().createElement(Gn,{appName:"Grafana App With Model Context Protocol",appVersion:"1.0.0"},r().createElement(So,null))),r().createElement("div",{style:{marginTop:"16px",display:"flex",justifyContent:"flex-end"}},r().createElement(Kn.Button,{variant:"primary",onClick:a},"Close"))))};function Io({modelMapping:e,modelNames:t,onChange:n}){return r().createElement(r().Fragment,null,r().createElement(Kn.IconButton,{name:"plus","aria-label":"Add model mapping",onClick:t=>{t.preventDefault(),n([...e,["",""]])}}),e.map((([a,o],i)=>r().createElement(To,{key:i,model:a,deployment:o,modelNames:t,onChange:(t,r)=>{n([...e.slice(0,i),[t,r],...e.slice(i+1)])},onRemove:()=>n([...e.slice(0,i),...e.slice(i+1)])}))))}function To({model:e,deployment:t,modelNames:n,onChange:a,onRemove:o}){return r().createElement(Kn.InlineFieldRow,null,r().createElement(Kn.InlineField,{label:"Model"},r().createElement(Kn.Select,{placeholder:"model label",options:n.filter((e=>e!==t&&""!==e)).map((e=>({label:e,value:e}))),value:e,onChange:e=>void 0!==e.value&&a(e.value,t)})),r().createElement(Kn.InlineField,{label:"Deployment"},r().createElement(Kn.Input,{width:40,name:"AzureDeployment",placeholder:"deployment name",value:t,onChange:t=>void 0!==t.currentTarget.value&&a(e,t.currentTarget.value)})),r().createElement(Kn.IconButton,{name:"trash-alt","aria-label":"Remove model mapping",onClick:e=>{e.preventDefault(),o()}}))}function Ao(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Po(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Ao(e,t,r[t])}))}return e}function $o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const jo="https://api.openai.com",Ro="https://<resource-name>.openai.azure.com";function Lo({settings:e,secrets:a,secretsSet:o,onChange:i,onChangeSecrets:s,allowCustomPath:l=!1}){const c=(0,Kn.useStyles2)(hi),d=t=>{i($o(Po({},e),{[t.currentTarget.name]:"checkbox"===t.currentTarget.type?t.currentTarget.checked:t.currentTarget.value.trim()}))},[u,p]=(0,t.useState)(void 0!==e.apiPath);var h,m,f,g;return(0,t.useEffect)((()=>{var t;const r=u?null!==(t=e.apiPath)&&void 0!==t?t:"":void 0;i($o(Po({},e),{apiPath:r}))}),[u]),r().createElement(Kn.FieldSet,null,"custom"!==e.provider&&r().createElement(Kn.Field,{label:"Provider"},r().createElement(Kn.Select,{"data-testid":n.appConfig.provider,options:[{label:"OpenAI",value:"openai"},{label:"Azure OpenAI",value:"azure"}],value:null!==(h=e.provider)&&void 0!==h?h:"openai",onChange:t=>{return r=t.value,void i($o(Po({},e),{provider:r,url:"openai"===r?jo:""}));var r},width:60})),r().createElement(Kn.Field,{label:"azure"===e.provider?"Azure OpenAI Language API Endpoint":"API URL",className:c.marginTop},r().createElement(Kn.Input,{width:60,name:"url","data-testid":n.appConfig.openAIUrl,value:"openai"===e.provider?jo:e.url,placeholder:"azure"===e.provider?Ro:"openai"===e.provider?jo:"https://llm.domain.com",onChange:d,disabled:"openai"===e.provider})),l&&r().createElement(Kn.Field,{label:"API Path",description:"Customize the API path appended to the URL. Defaults to /v1 if unchecked.",className:c.marginTop},r().createElement(Kn.Stack,{direction:"row",gap:1,alignItems:"center"},r().createElement(Kn.Checkbox,{"data-testid":n.appConfig.customizeOpenAIApiPath,name:"Use custom API path",value:u,onChange:e=>p(e.currentTarget.checked)}),r().createElement(Kn.Input,{width:57,name:"apiPath","data-testid":n.appConfig.openAIApiPath,value:null!==(m=e.apiPath)&&void 0!==m?m:"",placeholder:u?"":"/v1",onChange:d,disabled:!u}))),r().createElement(Kn.Field,{label:"azure"===e.provider?"Azure OpenAI Key":"API Key"},r().createElement(Kn.SecretInput,{width:60,"data-testid":n.appConfig.openAIKey,name:"openAIKey",value:a.openAIKey,isConfigured:null!==(f=o.openAIKey)&&void 0!==f&&f,placeholder:"azure"===e.provider?"":"sk-...",onChange:e=>s($o(Po({},a),{openAIKey:e.currentTarget.value})),onReset:()=>s($o(Po({},a),{openAIKey:""}))})),"openai"===e.provider&&r().createElement(Kn.Field,{label:"API Organization ID"},r().createElement(Kn.Input,{width:60,name:"organizationId","data-testid":n.appConfig.openAIOrganizationID,value:e.organizationId,placeholder:e.organizationId?"":"org-...",onChange:d})),"azure"===e.provider&&r().createElement(Kn.Field,{label:"Azure OpenAI Model Mapping",description:"Mapping from model name to Azure deployment name."},r().createElement(Io,{modelMapping:null!==(g=e.azureModelMapping)&&void 0!==g?g:[],modelNames:Object.values(Va),onChange:t=>i($o(Po({},e),{azureModelMapping:t}))})))}function No({width:e,height:t}){const n=(0,Kn.useTheme2)();return r().createElement("svg",{width:e,height:t,viewBox:"0 0 320 320",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r().createElement("g",{clipPath:"url(#clip0_10145_290560)"},r().createElement("path",{d:"M297.06 130.97C304.32 109.18 301.82 85.31 290.21 65.49C272.75 35.09 237.65 19.45 203.37 26.81C188.12 9.63002 166.21 -0.139981 143.24 1.93887e-05C108.2 -0.0799806 77.11 22.48 66.33 55.82C43.82 60.43 24.39 74.52 13.02 94.49C-4.57001 124.81 -0.560007 163.03 22.94 189.03C15.68 210.82 18.18 234.69 29.79 254.51C47.25 284.91 82.35 300.55 116.63 293.19C131.87 310.37 153.79 320.14 176.76 319.99C211.82 320.08 242.92 297.5 253.7 264.13C276.21 259.52 295.64 245.43 307.01 225.46C324.58 195.14 320.56 156.95 297.07 130.95L297.06 130.97ZM176.78 299.08C162.75 299.1 149.16 294.19 138.39 285.2C138.88 284.94 139.73 284.47 140.28 284.13L204 247.33C207.26 245.48 209.26 242.01 209.24 238.26V148.43L236.17 163.98C236.46 164.12 236.65 164.4 236.69 164.72V239.11C236.65 272.19 209.86 299.01 176.78 299.08ZM47.94 244.05C40.91 231.91 38.38 217.68 40.79 203.87C41.26 204.15 42.09 204.66 42.68 205L106.4 241.8C109.63 243.69 113.63 243.69 116.87 241.8L194.66 196.88V227.98C194.68 228.3 194.53 228.61 194.28 228.81L129.87 266C101.18 282.52 64.54 272.7 47.95 244.05H47.94ZM31.17 104.96C38.17 92.8 49.22 83.5 62.38 78.67C62.38 79.22 62.35 80.19 62.35 80.87V154.48C62.33 158.22 64.33 161.69 67.58 163.54L145.37 208.45L118.44 224C118.17 224.18 117.83 224.21 117.53 224.08L53.11 186.86C24.48 170.28 14.66 133.65 31.16 104.97L31.17 104.96ZM252.43 156.45L174.64 111.53L201.57 95.99C201.84 95.81 202.18 95.78 202.48 95.91L266.9 133.1C295.58 149.67 305.41 186.36 288.84 215.04C281.83 227.18 270.79 236.48 257.64 241.32V165.51C257.67 161.77 255.68 158.31 252.44 156.45H252.43ZM279.23 116.11C278.76 115.82 277.93 115.32 277.34 114.98L213.62 78.18C210.39 76.29 206.39 76.29 203.15 78.18L125.36 123.1V92C125.34 91.68 125.49 91.37 125.74 91.17L190.15 54.01C218.84 37.46 255.52 47.31 272.06 76.01C279.05 88.13 281.58 102.32 279.21 116.11H279.23ZM110.72 171.54L83.78 155.99C83.49 155.85 83.3 155.57 83.26 155.25V80.86C83.28 47.74 110.15 20.9 143.27 20.92C157.28 20.92 170.84 25.84 181.61 34.8C181.12 35.06 180.28 35.53 179.72 35.87L116 72.67C112.74 74.52 110.74 77.98 110.76 81.73L110.72 171.52V171.54ZM125.35 140L160 119.99L194.65 139.99V180L160 200L125.35 180V140Z",fill:n.colors.text.primary})),r().createElement("defs",null,r().createElement("clipPath",{id:"clip0_10145_290560"},r().createElement("rect",{width:"320",height:"320",fill:n.colors.text.primary}))))}function Mo(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Do(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Mo(e,t,r[t])}))}return e}function Fo(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Zo="https://api.anthropic.com";function zo({settings:e,secrets:t,secretsSet:a,onChange:o,onChangeSecrets:i}){const s=(0,Kn.useStyles2)(hi);var l;return r().createElement(Kn.FieldSet,null,r().createElement(Kn.Field,{label:"API URL",className:s.marginTop},r().createElement(Kn.Input,{width:60,name:"url","data-testid":n.appConfig.anthropicUrl,value:Zo,placeholder:Zo,onChange:t=>{o(Fo(Do({},e),{[t.currentTarget.name]:"checkbox"===t.currentTarget.type?t.currentTarget.checked:t.currentTarget.value.trim()}))},disabled:!0})),r().createElement(Kn.Field,{label:"API Key"},r().createElement(Kn.SecretInput,{width:60,"data-testid":n.appConfig.anthropicKey,name:"anthropicKey",value:t.anthropicKey,isConfigured:null!==(l=a.anthropicKey)&&void 0!==l&&l,placeholder:a.anthropicKey?"sk-ant-...":"not configured",onChange:e=>i(Fo(Do({},t),{anthropicKey:e.currentTarget.value})),onReset:()=>i(Fo(Do({},t),{anthropicKey:""}))})))}function Uo({width:e,height:t}){const n=(0,Kn.useTheme2)();return r().createElement("svg",{width:e,height:t,viewBox:"0 0 92.2 65",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r().createElement("path",{d:"M66.5,0H52.4l25.7,65h14.1L66.5,0z M25.7,0L0,65h14.4l5.3-13.6h26.9L51.8,65h14.4L40.5,0C40.5,0,25.7,0,25.7,0z M24.3,39.3l8.8-22.8l8.8,22.8H24.3z",fill:n.colors.text.primary}))}function qo(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Vo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){qo(e,t,r[t])}))}return e}function Go(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Bo({settings:e,secrets:n,secretsSet:a,optIn:o,setOptIn:i,onChange:s,onChangeSecrets:l}){const c=(0,Kn.useStyles2)(Ho),d=!0===e.enableGrafanaManagedLLM,u=function(e){var t;if(e.disabled||(null===(t=e.openAI)||void 0===t?void 0:t.disabled))return"disabled";switch(pi(e)){case"azure":case"openai":return"openai";case"custom":return"custom";case"test":return"test";case"grafana":return"grafana-provided";case"anthropic":return"anthropic";default:return"unconfigured"}}(e),[p,h]=(0,t.useState)(),[m,f]=(0,t.useState)(null),g=(t,r)=>{(()=>{var t;const r=null===(t=e.models)||void 0===t?void 0:t.mapping;return r&&Object.keys(r).some((e=>r[e]))})()&&pi(e)!==t?f({isOpen:!0,title:"Switch LLM Provider?",message:`You have existing model configurations that may not be compatible with the new provider. Your current model mappings will be preserved, but you may need to update the model names to work with ${v(t)}.`,onConfirm:()=>{r(),f(null)},onCancel:()=>{f(null)}}):r()},v=e=>{switch(e){case"openai":return"OpenAI";case"anthropic":return"Anthropic";case"azure":return"Azure OpenAI";case"custom":return"Custom API";case"grafana":return"Grafana-provided OpenAI";case"test":return"Test Provider";default:return"the selected provider"}};var y,b,_,E,w,x,O,k,S;return r().createElement(r().Fragment,null,e.enableDevSandbox&&r().createElement(Co,null),r().createElement(Kn.FieldSet,{label:"LLM Provider Configuration",className:c.sidePadding},d&&r().createElement("div",{className:c.providerSection},r().createElement("div",{className:c.sectionHeader},r().createElement("h4",null,"Grafana-Provided Service"," ","grafana-provided"===u&&r().createElement(Kn.Badge,{text:"Currently Active",color:"green"}))),r().createElement("div",{onClick:()=>{"grafana-provided"!==u&&(void 0===p&&h(e.provider),s(Go(Vo({},e),{provider:"grafana",disabled:!1,openAI:{disabled:!1}})))}},r().createElement(Kn.Card,{isSelected:"grafana-provided"===u,className:c.cardWithoutBottomMargin},r().createElement(Kn.Card.Heading,null,"Use OpenAI provided by Grafana"),r().createElement(Kn.Card.Description,null,r().createElement("div",null,"Enable LLM features in Grafana by using a connection to OpenAI that is provided by Grafana"),"grafana-provided"===u&&r().createElement(r().Fragment,null,r().createElement("div",{className:c.openaiTermsBox},r().createElement("h4",null,"Terms of Usage (Last updated: February 16th, 2024)"),r().createElement("div",null,"To enable OpenAI via Grafana Labs, please note that some data from your Grafana instance will be sent to OpenAI when you use the LLM-based features. Grafana Labs imposes usage limits for this service."),r().createElement("div",null,"Additionally, the following terms (\"AI Terms\") are hereby added to and become part of your licensing agreement with Grafana Labs (the \"Agreement\") as additional terms. Capitalized terms not defined in these AI Terms have the meanings given in the Agreement. These terms apply to your specific use of the OpenAI via Grafana Labs feature(s), and are separate, necessary terms regarding your use of this feature and therefore are not 'click-wrap', 'shrink-wrap', different or additional terms, or the like, to the extent your licensing agreement with Grafana Labs purports to supersede any such terms."),r().createElement("ul",null,r().createElement("li",null,"Grafana Labs uses OpenAI's API platform to provide the LLM features."),r().createElement("li",null,"OpenAI does not train aggregated models on inputs or outputs of the API platform as used in connection with Grafana Labs Product(s)."),r().createElement("li",null,"OpenAI does retain data for a short time in order to provide the services and monitor for abuse. All data sent to OpenAI is encrypted in transit and at rest."),r().createElement("li",null,"All features utilizing OpenAI are clearly marked in the Grafana Labs Product(s), and each feature sends minimal data to OpenAIand only at the request of a user (for example, when a user clicks the button to request an Incident auto-summary)."),r().createElement("li",null,"Grafana Labs will add new features regularly that utilize features connecting to OpenAI's APIs, which may include, but are not limited to:",r().createElement("ul",null,r().createElement("li",null,"Explaining Flamegraphs & offer suggestions to fix issues"),r().createElement("li",null,"Incident auto-summary"),r().createElement("li",null,"Suggesting names & descriptions for panels & dashboards, and summarize differences when saving changes"),r().createElement("li",null,"Explaining error log lines in Sift"),r().createElement("li",null,"Generating KQL queries in the Azure Data Explorer plugin"))),r().createElement("li",null,"Visit the OpenAI trust portal for more detail about OpenAI:"," ",r().createElement(Kn.Button,{size:"sm",variant:"secondary",onClick:e=>{window.open("https://trust.openai.com/","_blank"),e.stopPropagation()}},"https://trust.openai.com/")),r().createElement("li",null,"If you enable this feature, OpenAI will be a subprocessor of Grafana Labs for the purpose of any data processing agreement you may have in place with Grafana Labs."),r().createElement("li",null,"Disclaimer. Outputs are generated through machine learning processes and are not tested, verified, endorsed or guaranteed to be accurate, complete or current by Grafana Labs. You should independently review and verify all outputs as to appropriateness for any or all of your use cases or applications. The warranties, disclaimers, and limitations of liability in the Agreement apply to the AI Features."))),r().createElement("div",null,'By clicking the "I Accept" button, you agree to these additional AI Terms on behalf of yourself and/or your organization. Please read these terms carefully before proceeding. If you do not agree to these terms, do not click the "I Accept" button.'),r().createElement(Kn.Checkbox,{value:o,onClick:()=>{i(!o)},label:"I Accept"}))),r().createElement(Kn.Card.Figure,null,r().createElement(Kn.Icon,{name:"grafana",size:"lg"}))))),r().createElement("div",{className:c.providerSection},r().createElement("div",{className:c.sectionHeader},r().createElement("h4",null,"Bring Your Own Service"," ",d&&("openai"===u||"anthropic"===u||"custom"===u)&&r().createElement(Kn.Badge,{text:"Currently Active",color:"green"}))),r().createElement("div",{onClick:()=>{"openai"!==u&&g("openai",(()=>{"openai"===p||"azure"===p?(s(Go(Vo({},e),{provider:p,disabled:!1,openAI:{disabled:!1}})),h(void 0)):(s(Go(Vo({},e),{provider:"openai",disabled:!1,openAI:{disabled:!1}})),h(void 0))}))}},r().createElement(Kn.Card,{isSelected:"openai"===u,className:c.cardWithoutBottomMargin},r().createElement(Kn.Card.Heading,null,"Use OpenAI-compatible API"),r().createElement(Kn.Card.Description,null,"Enable LLM features in Grafana using OpenAI-compatible API","openai"===u&&r().createElement(r().Fragment,null,r().createElement(Lo,{settings:null!==(y=e.openAI)&&void 0!==y?y:{},onChange:t=>s(Go(Vo({},e),{openAI:t})),secrets:n,secretsSet:a,onChangeSecrets:l,allowCustomPath:!1}),r().createElement(ao,{provider:null!==(b=e.provider)&&void 0!==b?b:"openai",settings:null!==(_=e.models)&&void 0!==_?_:{mapping:{}},onChange:t=>s(Go(Vo({},e),{models:t}))}))),r().createElement(Kn.Card.Figure,null,r().createElement(No,{width:20,height:20})))),r().createElement("div",{onClick:()=>{"anthropic"!==u&&g("anthropic",(()=>{s(Go(Vo({},e),{provider:"anthropic",disabled:!1}))}))}},r().createElement(Kn.Card,{isSelected:"anthropic"===u,className:c.cardWithoutBottomMargin},r().createElement(Kn.Card.Heading,null,"Use Anthropic API"),r().createElement(Kn.Card.Description,null,"Enable LLM features in Grafana using Anthropic's Claude models","anthropic"===u&&r().createElement(r().Fragment,null,r().createElement(zo,{settings:null!==(E=e.anthropic)&&void 0!==E?E:{},onChange:t=>s(Go(Vo({},e),{anthropic:t})),secrets:n,secretsSet:a,onChangeSecrets:l}),r().createElement(ao,{provider:null!==(w=e.provider)&&void 0!==w?w:"anthropic",settings:null!==(x=e.models)&&void 0!==x?x:{mapping:{}},onChange:t=>s(Go(Vo({},e),{models:t}))}))),r().createElement(Kn.Card.Figure,null,r().createElement(Uo,{width:20,height:20})))),r().createElement("div",{onClick:()=>{"custom"!==u&&g("custom",(()=>{s(Go(Vo({},e),{provider:"custom",disabled:!1,openAI:{disabled:!1}}))}))}},r().createElement(Kn.Card,{isSelected:"custom"===u,className:c.cardWithoutBottomMargin},r().createElement(Kn.Card.Heading,null,"Use a Custom API"),r().createElement(Kn.Card.Description,null,'Enable LLM features in Grafana using a custom API (with "OpenAI-like" signature)',"custom"===u&&r().createElement(r().Fragment,null,r().createElement(Lo,{settings:null!==(O=e.openAI)&&void 0!==O?O:{},onChange:t=>s(Go(Vo({},e),{openAI:t})),secrets:n,secretsSet:a,onChangeSecrets:l,allowCustomPath:!0}),r().createElement(ao,{provider:null!==(k=e.provider)&&void 0!==k?k:"custom",settings:null!==(S=e.models)&&void 0!==S?S:{mapping:{}},onChange:t=>s(Go(Vo({},e),{models:t}))}))),r().createElement(Kn.Card.Figure,null,r().createElement(Kn.Icon,{name:"ai",size:"lg"})))),!1,r().createElement(Kn.Card,{isSelected:"disabled"===u,onClick:()=>{"disabled"!==u&&(void 0===p&&h(e.provider),s(Go(Vo({},e),{provider:void 0,disabled:!0,openAI:Go(Vo({},e.openAI),{disabled:!0})})))},className:c.cardWithoutBottomMargin},r().createElement(Kn.Card.Heading,null,"Disable all LLM features in Grafana"),r().createElement(Kn.Card.Description,null,""),r().createElement(Kn.Card.Figure,null,r().createElement(Kn.Icon,{name:"times",size:"lg"}))))),m&&r().createElement(Kn.ConfirmModal,{isOpen:m.isOpen,title:m.title,body:m.message,confirmText:"Switch Provider",dismissText:"Cancel",onConfirm:m.onConfirm,onDismiss:m.onCancel}))}const Ho=e=>({sidePadding:ea.css`
    margin-left: ${e.spacing(1)};
    margin-right: ${e.spacing(1)};
  `,nestedList:ea.css`
    margin-left: ${e.spacing(3)};
  `,openaiTermsBox:(0,ea.css)({overflowY:"auto",height:"250px",marginRight:e.spacing(3),marginBottom:e.spacing(1),padding:`${e.spacing(1)} ${e.spacing(2)} ${e.spacing(1)} ${e.spacing(2)}`,border:`1px solid ${e.colors.border.medium}`,background:e.colors.background.primary,color:e.colors.text.primary," ul":{paddingLeft:e.spacing(2)},"> ul > li:not(:last-child)":{marginBottom:e.spacing(.5)}}),cardWithoutBottomMargin:ea.css`
    margin-bottom: 0;
    margin-top: ${e.spacing(1)};
  `,sectionHeader:ea.css`
    margin-top: ${e.spacing(3)};
    margin-bottom: ${e.spacing(2)};
    display: flex;
    align-items: center;
    gap: ${e.spacing(1)};

    h4 {
      margin: 0;
      color: ${e.colors.text.primary};
      font-weight: ${e.typography.fontWeightMedium};
      display: flex;
      align-items: center;
      gap: ${e.spacing(1)};
    }
  `,providerSection:ea.css`
    background: ${e.colors.background.secondary};
    border: 1px solid ${e.colors.border.weak};
    border-radius: ${e.shape.borderRadius()};
    padding: ${e.spacing(2)};
    margin-bottom: ${e.spacing(2)};

    &:last-child {
      margin-bottom: 0;
    }
  `});function Wo(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ko(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Wo(e,t,r[t])}))}return e}function Xo(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Jo=({settings:e,secrets:t,secretsSet:a,onChange:o,onChangeSecrets:i,secretKey:s})=>{const l=(0,Kn.useStyles2)(hi);var c;return r().createElement(r().Fragment,null,r().createElement(Kn.InlineField,{label:"User",labelWidth:l.inlineFieldWidth},r().createElement(Kn.Input,{width:l.inlineFieldInputWidth,placeholder:"user","data-testid":n.appConfig.basicAuthUsername,value:null==e?void 0:e.basicAuthUser,onChange:t=>o(Xo(Ko({},e),{basicAuthUser:t.currentTarget.value}))})),r().createElement(Kn.InlineField,{label:"Password",labelWidth:l.inlineFieldWidth},r().createElement(Kn.SecretInput,{width:l.inlineFieldInputWidth,placeholder:"password","data-testid":n.appConfig.basicAuthPassword,value:t[s],isConfigured:null!==(c=a[s])&&void 0!==c&&c,onReset:()=>{i(Xo(Ko({},t),{[s]:""}))},onChange:e=>{i(Xo(Ko({},t),{[s]:e.currentTarget.value}))}})))};function Yo(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Yo(e,t,r[t])}))}return e}function ei(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ti="text-embedding-ada-002";function ri({settings:e,secrets:t,secretsSet:a,onChange:o,onChangeSecrets:i}){var s,l,c;return r().useEffect((()=>{var t,r;"openai"===(null==e||null===(t=e.embed)||void 0===t?void 0:t.type)&&(null==e?void 0:e.model)!==ti?o(ei(Qo({},e),{model:ti})):"grafana/vectorapi"!==(null==e||null===(r=e.embed)||void 0===r?void 0:r.type)||void 0!==(null==e?void 0:e.model)&&(null==e?void 0:e.model)!==ti||o(ei(Qo({},e),{model:"BAAI/bge-small-en-v1.5"}))}),[e,null==e||null===(s=e.embed)||void 0===s?void 0:s.type,o]),r().createElement(Kn.FieldSet,{label:"Vector Settings"},r().createElement(Kn.Field,{label:"Enabled",description:"Enable vector database powered features."},r().createElement(Kn.Checkbox,{name:"enabled","data-testid":n.appConfig.vectorEnabled,value:(null==e?void 0:e.enabled)||!1,onChange:t=>o(ei(Qo({},e),{enabled:t.currentTarget.checked}))})),(null==e?void 0:e.enabled)&&r().createElement(r().Fragment,null,r().createElement(Kn.Field,{label:"Model",description:"The model used by the embedder and for embeddings stored in the store",disabled:"openai"===(null===(l=e.embed)||void 0===l?void 0:l.type)||void 0===(null===(c=e.embed)||void 0===c?void 0:c.type)},r().createElement(Kn.Input,{width:60,name:"model","data-testid":n.appConfig.model,value:null==e?void 0:e.model,placeholder:null==e?void 0:e.model,onChange:t=>o(ei(Qo({},e),{model:t.currentTarget.value}))})),r().createElement(ni,{settings:null==e?void 0:e.embed,secrets:t,secretsSet:a,onChange:t=>o(ei(Qo({},e),{embed:t})),onChangeSecrets:i}),r().createElement(ii,{settings:null==e?void 0:e.store,secrets:t,secretsSet:a,onChange:t=>o(ei(Qo({},e),{store:t})),onChangeSecrets:i})))}function ni({settings:e,secrets:t,secretsSet:a,onChange:o,onChangeSecrets:i}){var s,l,c;const d=(0,Kn.useStyles2)(hi);var u;return r().createElement(r().Fragment,null,r().createElement("h4",null,"Embedder"),r().createElement(Kn.Field,{label:"Embedder Provider",description:"Select the embedder API to use"},r().createElement(r().Fragment,null,r().createElement(Kn.Select,{options:[{label:"OpenAI API",value:"openai"},{label:"Grafana Vector API",value:"grafana/vectorapi"}],placeholder:"Select Embedder Provider",value:null==e?void 0:e.type,width:60,onChange:e=>o({type:e.value})}),"openai"===(null==e?void 0:e.type)&&r().createElement(Kn.Label,null," Using configured OpenAI as embedder provider "))),"grafana/vectorapi"===(null==e?void 0:e.type)&&r().createElement(r().Fragment,null,r().createElement(Kn.Field,{label:"Auth Type"},r().createElement(Kn.Select,{options:[{label:"No Auth",value:"no-auth"},{label:"Basic Auth",value:"basic-auth"}],value:null!==(u=null==e||null===(s=e.grafanaVectorAPI)||void 0===s?void 0:s.authType)&&void 0!==u?u:"no-auth",onChange:t=>void 0!==t.value&&o(ei(Qo({},e),{grafanaVectorAPI:ei(Qo({},e.grafanaVectorAPI),{authType:t.value})})),width:60})),r().createElement(Kn.InlineField,{label:"URL",tooltip:"Address of the Grafana Vector API",labelWidth:d.inlineFieldWidth},r().createElement(Kn.Input,{name:"url",value:null==e||null===(l=e.grafanaVectorAPI)||void 0===l?void 0:l.url,width:d.inlineFieldInputWidth,"data-testid":n.appConfig.grafanaVectorApiUrl,placeholder:"http://vectorapi:8889",onChange:t=>o(ei(Qo({},e),{grafanaVectorAPI:ei(Qo({},e.grafanaVectorAPI),{url:t.currentTarget.value})}))})),"basic-auth"===(null==e||null===(c=e.grafanaVectorAPI)||void 0===c?void 0:c.authType)&&r().createElement(Jo,{settings:e.grafanaVectorAPI,secrets:t,secretsSet:a,onChange:t=>o(ei(Qo({},e),{grafanaVectorAPI:t})),onChangeSecrets:i,secretKey:"vectorEmbedderBasicAuthPassword"})))}function ai({settings:e,secrets:t,secretsSet:a,onChange:o,onChangeSecrets:i}){const s=(0,Kn.useStyles2)(hi);var l;return r().createElement(r().Fragment,null,r().createElement(Kn.Field,{label:"Address",description:"Address of the qdrant gRPC server"},r().createElement(Kn.Input,{width:s.inlineFieldInputWidth,name:"url","data-testid":n.appConfig.qdrantAddress,value:null==e?void 0:e.address,placeholder:"localhost:6334",onChange:t=>o(ei(Qo({},e),{address:t.currentTarget.value}))})),r().createElement(Kn.Field,{label:"Secure",description:"Whether to use a secure connection"},r().createElement(Kn.Checkbox,{name:"secure","data-testid":n.appConfig.qdrantSecure,checked:null==e?void 0:e.secure,onChange:t=>o(ei(Qo({},e),{secure:t.currentTarget.checked}))})),(null==e?void 0:e.secure)&&r().createElement(Kn.Field,{label:"API key",description:"API key for the qdrant gRPC server"},r().createElement(Kn.SecretInput,{name:"qdrantApiKey",width:s.inlineFieldInputWidth,"data-testid":n.appConfig.qdrantApiKey,onChange:e=>i(ei(Qo({},t),{qdrantApiKey:e.currentTarget.value})),onReset:()=>i(ei(Qo({},t),{qdrantApiKey:""})),isConfigured:null!==(l=a.qdrantApiKey)&&void 0!==l&&l,value:t.qdrantApiKey})))}function oi({settings:e,onChange:t}){const a=(0,Kn.useStyles2)(hi);return r().createElement(r().Fragment,null,r().createElement(Kn.InlineField,{label:"URL",tooltip:"Address of the Grafana Vector API",labelWidth:a.inlineFieldWidth},r().createElement(Kn.Input,{name:"url",value:null==e?void 0:e.url,width:a.inlineFieldInputWidth,"data-testid":n.appConfig.grafanaVectorApiUrl,placeholder:"http://vectorapi:8889",onChange:r=>t(ei(Qo({},e),{url:r.currentTarget.value}))})))}function ii({settings:e,secrets:t,secretsSet:n,onChange:a,onChangeSecrets:o}){var i,s,l;return r().createElement(r().Fragment,null,r().createElement("h4",null,"Store"),r().createElement(Kn.Field,{label:"Store Type",description:"The type of store"},r().createElement(Kn.Select,{options:[{label:"Qdrant",value:"qdrant"},{label:"Grafana Vector API",value:"grafana/vectorapi"}],value:null==e?void 0:e.type,onChange:t=>void 0!==t.value&&a(ei(Qo({},e),{type:t.value,qdrant:void 0,grafanaVectorAPI:void 0})),width:60})),"qdrant"===(null==e?void 0:e.type)&&r().createElement(ai,{settings:e.qdrant,secrets:t,secretsSet:n,onChange:t=>a(ei(Qo({},e),{qdrant:t})),onChangeSecrets:o}),"grafana/vectorapi"===(null==e?void 0:e.type)&&r().createElement(r().Fragment,null,r().createElement(Kn.Field,{label:"Auth Type"},r().createElement(Kn.Select,{options:[{label:"No Auth",value:"no-auth"},{label:"Basic Auth",value:"basic-auth"}],value:null!==(l=null==e||null===(i=e.grafanaVectorAPI)||void 0===i?void 0:i.authType)&&void 0!==l?l:"no-auth",onChange:t=>void 0!==t.value&&a(ei(Qo({},e),{grafanaVectorAPI:ei(Qo({},e.grafanaVectorAPI),{authType:t.value})})),width:60})),r().createElement(oi,{settings:e.grafanaVectorAPI,onChange:t=>a(ei(Qo({},e),{grafanaVectorAPI:t}))})),"grafana/vectorapi"===(null==e?void 0:e.type)&&"basic-auth"===(null==e||null===(s=e.grafanaVectorAPI)||void 0===s?void 0:s.authType)&&r().createElement(Jo,{settings:e.grafanaVectorAPI,secrets:t,secretsSet:n,onChange:t=>a(ei(Qo({},e),{grafanaVectorAPI:t})),onChangeSecrets:o,secretKey:"vectorStoreBasicAuthPassword"}))}function si(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function li(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){si(o,n,a,i,s,"next",e)}function s(e){si(o,n,a,i,s,"throw",e)}i(void 0)}))}}function ci(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function di(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ci(e,t,r[t])}))}return e}function ui(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function pi(e){var t;return e.provider?e.provider:null===(t=e.openAI)||void 0===t?void 0:t.provider}const hi=e=>({colorWeak:ea.css`
    color: ${e.colors.text.secondary};
  `,marginTop:ea.css`
    margin-top: ${e.spacing(3)};
  `,inlineFieldWidth:15,inlineFieldInputWidth:40}),mi=(fi=li((function*(e,t=!1,r){const n={jsonData:r.jsonData,secureJsonData:r.secureJsonData};!0===t&&(yield(e=>{const t=(0,f.getBackendSrv)().fetch({url:"/api/plugins/grafana-llm-app/resources/save-plugin-settings",method:"POST",data:e});return(0,Nn.lastValueFrom)(t)})(n).then((e=>{if(!e.ok)throw e.data}))),yield((e,t)=>{const r=(0,f.getBackendSrv)().fetch({url:`/api/plugins/${e}/settings`,method:"POST",data:t});return(0,Nn.lastValueFrom)(r)})(e,r).then((e=>{if(!e.ok)throw e.data}))})),function(e){return fi.apply(this,arguments)});var fi;function gi(e){return vi.apply(this,arguments)}function vi(){return(vi=li((function*(e){return(0,Nn.lastValueFrom)((0,f.getBackendSrv)().fetch({url:"api/plugins/grafana-llm-app/resources/grafana-llm-state",method:"POST",data:{allowed:e}})).then((e=>{if(!e.ok)throw e.data}))}))).apply(this,arguments)}function yi(){return(yi=li((function*(){return(0,Nn.lastValueFrom)((0,f.getBackendSrv)().fetch({url:"api/plugins/grafana-llm-app/resources/grafana-llm-state",method:"GET"})).then((e=>{var t,r,n;if(!e.ok||"success"!==(null===(t=e.data)||void 0===t?void 0:t.status))throw e.data;return null!==(n=null===(r=e.data.data)||void 0===r?void 0:r.allowed)&&void 0!==n&&n}))}))).apply(this,arguments)}const bi=(new e.AppPlugin).setRootPage((function(){const e=(t=(0,Kn.useTheme2)(),{container:ea.css`
    display: flex;
    flex-direction: column;
    gap: ${t.spacing(4)};
    padding: ${t.spacing(2)};
    max-width: 1200px;
    margin: 0 auto;
  `,header:ea.css`
    text-align: center;
    margin-bottom: ${t.spacing(3)};
  `,title:ea.css`
    font-size: ${t.typography.h1.fontSize};
    font-weight: ${t.typography.h1.fontWeight};
    color: ${t.colors.text.primary};
    margin: 0 0 ${t.spacing(1)} 0;
  `,subtitle:ea.css`
    font-size: ${t.typography.h4.fontSize};
    color: ${t.colors.text.secondary};
    margin: 0;
    font-weight: normal;
  `,sectionsContainer:ea.css`
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: ${t.spacing(4)};

    @media (max-width: 768px) {
      grid-template-columns: 1fr;
    }
  `,section:ea.css`
    background: ${t.colors.background.secondary};
    border-radius: ${t.shape.radius.default};
    border: 1px solid ${t.colors.border.medium};
    padding: ${t.spacing(3)};
    overflow: hidden;
  `,sectionTitle:ea.css`
    font-size: ${t.typography.h3.fontSize};
    font-weight: ${t.typography.h3.fontWeight};
    color: ${t.colors.text.primary};
    margin: 0 0 ${t.spacing(2)} 0;
    padding-bottom: ${t.spacing(1)};
    border-bottom: 1px solid ${t.colors.border.weak};
  `,sectionContent:ea.css`
    // Remove default margins from child components
    h1,
    h2 {
      margin-top: 0;
      font-size: ${t.typography.h4.fontSize};
    }

    pre {
      max-height: 300px;
      overflow-y: auto;
      background: ${t.colors.background.primary};
      border: 1px solid ${t.colors.border.weak};
      border-radius: ${t.shape.radius.default};
      padding: ${t.spacing(2)};
      font-size: ${t.typography.bodySmall.fontSize};
    }

    ul {
      margin: 0;
      padding-left: ${t.spacing(3)};
    }

    li {
      margin-bottom: ${t.spacing(.5)};
      line-height: 1.5;
    }
  `,fullWidthSection:ea.css`
    grid-column: 1 / -1;
    background: ${t.colors.background.secondary};
    border-radius: ${t.shape.radius.default};
    border: 1px solid ${t.colors.border.medium};
    padding: ${t.spacing(3)};
    margin-top: ${t.spacing(2)};
  `,infoBox:ea.css`
    background: ${t.colors.info.transparent};
    border: 1px solid ${t.colors.info.border};
    border-radius: ${t.shape.radius.default};
    padding: ${t.spacing(2)};
    margin-bottom: ${t.spacing(3)};
    color: ${t.colors.info.text};
    font-size: ${t.typography.bodySmall.fontSize};
    line-height: 1.4;
  `});var t;return r().createElement(f.PluginPage,null,r().createElement("div",{"data-testid":n.mainPage.container,className:e.container},r().createElement("header",{className:e.header},r().createElement("h1",{className:e.title},"Grafana LLM"),r().createElement("p",{className:e.subtitle},"Large Language Model integration with Model Context Protocol support")),r().createElement("div",{className:e.infoBox},r().createElement("strong",null,"About this plugin:")," This plugin provides LLM capabilities to Grafana through OpenAI-compatible APIs and extends functionality with Model Context Protocol (MCP) tools for enhanced AI workflows."),r().createElement("div",{className:e.sectionsContainer},r().createElement("section",{className:e.section},r().createElement("h2",{className:e.sectionTitle},"Language Models"),r().createElement("div",{className:e.sectionContent},r().createElement(g,null))),r().createElement("section",{className:e.section},r().createElement("h2",{className:e.sectionTitle},"MCP Tools"),r().createElement("div",{className:e.sectionContent},r().createElement(Qn,null)))),r().createElement("section",{className:e.fullWidthSection},r().createElement("h2",{className:e.sectionTitle},"Getting Started"),r().createElement("div",{className:e.sectionContent},r().createElement("p",null,r().createElement("strong",null,"Models:")," View and manage available language models configured for this Grafana instance. Models are provided through the configured LLM provider (OpenAI, Anthropic, or custom)."),r().createElement("p",null,r().createElement("strong",null,"MCP Tools:")," Model Context Protocol tools extend LLM capabilities with access to Grafana data sources, dashboards, alerts, and other contextual information. These tools can be used by AI assistants to provide more relevant and data-driven responses.")))))})).addConfigPage({title:"Configuration",icon:"cog",body:({plugin:e})=>{const a=(0,Kn.useStyles2)(hi),{enabled:o,pinned:i,jsonData:s,secureJsonFields:l}=e.meta,[c,d]=(0,t.useState)(null!=s?s:{}),[u,p]=(0,t.useState)({}),[h,m]=(0,t.useState)(function(e){var t,r,n,a,o;return{openAIKey:null!==(t=e.openAIKey)&&void 0!==t&&t,anthropicKey:null!==(r=e.anthropicKey)&&void 0!==r&&r,vectorEmbedderBasicAuthPassword:null!==(n=e.vectorEmbedderBasicAuthPassword)&&void 0!==n&&n,vectorStoreBasicAuthPassword:null!==(a=e.vectorStoreBasicAuthPassword)&&void 0!==a&&a,qdrantApiKey:null!==(o=e.qdrantApiKey)&&void 0!==o&&o}}(null!=l?l:{})),[g,v]=(0,t.useState)(!1),[y,b]=(0,t.useState)(!1),[_,E]=(0,t.useState)(!1),[w,x]=(0,t.useState)(void 0),O=(()=>{if("grafana"===(null==c?void 0:c.provider)&&!y)return'You must click the "I Accept" checkbox to use OpenAI provided by Grafana'})();(0,t.useEffect)((()=>{const e=(t=li((function*(){const e=yield function(){return yi.apply(this,arguments)}();b(e)})),function(){return t.apply(this,arguments)});var t;!0===c.enableGrafanaManagedLLM&&e()}),[c.enableGrafanaManagedLLM]),(0,t.useEffect)((()=>{g&&x(void 0)}),[g]);const k=(S=li((function*(){if(void 0!==O)return;E(!0),x(void 0);const t=di({},e.meta.jsonData);let r;const n={};for(r in h)h[r]||(n[r]=u[r]);const a=ui(di({},c),{provider:pi(c)});try{let r;yield mi(e.meta.id,c.enableGrafanaManagedLLM,{enabled:o,pinned:i,jsonData:a,secureJsonData:n});const l=pi(c);var s;if(void 0!==l&&(r=(yield(e=>{const t=(0,f.getBackendSrv)().fetch({url:`/api/plugins/${e}/health`});return(0,Nn.lastValueFrom)(t)})(e.meta.id)).data,"ok"!==(null===(s=r.status)||void 0===s?void 0:s.toLowerCase())))return yield mi(e.meta.id,c.enableGrafanaManagedLLM,{enabled:o,pinned:i,jsonData:t,secureJsonData:{}}),e.meta.jsonData=t,x(r),void E(!1);x(r),!0===c.enableGrafanaManagedLLM&&(y&&"grafana"!==l?yield gi(!1):yield gi(y)),e.meta.jsonData=a,E(!1),v(!1)}catch(r){try{yield mi(e.meta.id,c.enableGrafanaManagedLLM,{enabled:o,pinned:i,jsonData:t,secureJsonData:{}}),e.meta.jsonData=t}catch(e){console.error("Failed to rollback settings:",e)}throw E(!1),r}})),function(){return S.apply(this,arguments)});var S;return r().createElement("div",{"data-testid":n.appConfig.container},r().createElement(Bo,{settings:c,onChange:e=>{d(e),v(!0)},secrets:u,secretsSet:h,optIn:y,setOptIn:e=>{b(e),v(!0)},onChangeSecrets:e=>{p(e);for(const t of Object.keys(e))m(ui(di({},h),{[t]:!1}));v(!0)}}),!0===c.displayVectorStoreOptions&&r().createElement(ri,{settings:c.vector,secrets:u,secretsSet:h,onChange:e=>{d(ui(di({},c),{vector:e})),v(!0)},onChangeSecrets:e=>{p(e);for(const t of Object.keys(e))m(ui(di({},h),{[t]:!1}));v(!0)}}),void 0!==O&&r().createElement(Kn.Alert,{title:O,severity:"error"}),_?r().createElement(Kn.LoadingPlaceholder,{text:"Running health check..."}):w&&r().createElement(aa,w),r().createElement("div",{className:a.marginTop},r().createElement(Kn.Button,{type:"submit","data-testid":n.appConfig.submit,onClick:k,disabled:!g||_||void 0!==O},"Save & test")))},id:"configuration"})})(),c})()));
//# sourceMappingURL=module.js.map